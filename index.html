 // This JavaScript object contains the 2024 season rosters for all 32 NFL teams,
// organized by conference and division.
// The data includes key players at the Quarterback, Running Back, Wide Receiver,
// and Tight End positions.

const nflRosters2024 = {
  // AFC EAST
  "Buffalo Bills": {
    division: "AFC East",
    roster: {
      qbs: ["Josh Allen"],
      rbs: ["James Cook"],
      wrs: ["Khalil Shakir", "Keon Coleman"],
      tes: ["Dalton Kincaid", "Dawson Knox"]
    }
  },
  "Miami Dolphins": {
    division: "AFC East",
    roster: {
      qbs: ["Tua Tagovailoa"],
      rbs: ["Raheem Mostert"],
      wrs: ["Tyreek Hill", "Jaylen Waddle"],
      tes: ["Jonnu Smith"]
    }
  },
  "New England Patriots": {
    division: "AFC East",
    roster: {
      qbs: ["Jacoby Brissett", "Drake Maye"],
      rbs: ["Rhamondre Stevenson"],
      wrs: ["Kendrick Bourne", "DeMario Douglas"],
      tes: ["Hunter Henry"]
    }
  },
  "New York Jets": {
    division: "AFC East",
    roster: {
      qbs: ["Aaron Rodgers"],
      rbs: ["Breece Hall"],
      wrs: ["Garrett Wilson", "Mike Williams"],
      tes: ["Tyler Conklin"]
    }
  },

  // AFC NORTH
  "Baltimore Ravens": {
    division: "AFC North",
    roster: {
      qbs: ["Lamar Jackson"],
      rbs: ["Derrick Henry"],
      wrs: ["Zay Flowers", "Rashod Bateman"],
      tes: ["Mark Andrews"]
    }
  },
  "Cincinnati Bengals": {
    division: "AFC North",
    roster: {
      qbs: ["Joe Burrow"],
      rbs: ["Zack Moss"],
      wrs: ["Ja'Marr Chase", "Tee Higgins"],
      tes: ["Mike Gesicki"]
    }
  },
  "Cleveland Browns": {
    division: "AFC North",
    roster: {
      qbs: ["Deshaun Watson"],
      rbs: ["Nick Chubb"],
      wrs: ["Amari Cooper", "Jerry Jeudy"],
      tes: ["David Njoku"]
    }
  },
  "Pittsburgh Steelers": {
    division: "AFC North",
    roster: {
      qbs: ["Russell Wilson", "Justin Fields"],
      rbs: ["Najee Harris", "Jaylen Warren"],
      wrs: ["George Pickens", "Roman Wilson"],
      tes: ["Pat Freiermuth"]
    }
  },

  // AFC SOUTH
  "Houston Texans": {
    division: "AFC South",
    roster: {
      qbs: ["C.J. Stroud"],
      rbs: ["Joe Mixon"],
      wrs: ["Nico Collins", "Tank Dell", "Stefon Diggs"],
      tes: ["Dalton Schultz"]
    }
  },
  "Indianapolis Colts": {
    division: "AFC South",
    roster: {
      qbs: ["Anthony Richardson"],
      rbs: ["Jonathan Taylor"],
      wrs: ["Michael Pittman Jr.", "Josh Downs"],
      tes: ["Mo Alie-Cox"]
    }
  },
  "Jacksonville Jaguars": {
    division: "AFC South",
    roster: {
      qbs: ["Trevor Lawrence"],
      rbs: ["Travis Etienne Jr."],
      wrs: ["Christian Kirk", "Gabe Davis", "Brian Thomas Jr."],
      tes: ["Evan Engram"]
    }
  },
  "Tennessee Titans": {
    division: "AFC South",
    roster: {
      qbs: ["Will Levis"],
      rbs: ["Tony Pollard"],
      wrs: ["Calvin Ridley", "DeAndre Hopkins"],
      tes: ["Chigoziem Okonkwo"]
    }
  },

  // AFC WEST
  "Denver Broncos": {
    division: "AFC West",
    roster: {
      qbs: ["Bo Nix"],
      rbs: ["Javonte Williams"],
      wrs: ["Courtland Sutton", "Troy Franklin"],
      tes: ["Greg Dulcich"]
    }
  },
  "Kansas City Chiefs": {
    division: "AFC West",
    roster: {
      qbs: ["Patrick Mahomes"],
      rbs: ["Isiah Pacheco"],
      wrs: ["Hollywood Brown", "Rashee Rice"],
      tes: ["Travis Kelce"]
    }
  },
  "Las Vegas Raiders": {
    division: "AFC West",
    roster: {
      qbs: ["Gardner Minshew", "Aidan O'Connell"],
      rbs: ["Zamir White"],
      wrs: ["Davante Adams", "Jakobi Meyers"],
      tes: ["Michael Mayer"]
    }
  },
  "Los Angeles Chargers": {
    division: "AFC West",
    roster: {
      qbs: ["Justin Herbert"],
      rbs: ["Gus Edwards"],
      wrs: ["Ladd McConkey", "Quentin Johnston"],
      tes: ["Hayden Hurst"]
    }
  },

  // NFC EAST
  "Dallas Cowboys": {
    division: "NFC East",
    roster: {
      qbs: ["Dak Prescott"],
      rbs: ["Ezekiel Elliott"],
      wrs: ["CeeDee Lamb"],
      tes: ["Jake Ferguson"]
    }
  },
  "New York Giants": {
    division: "NFC East",
    roster: {
      qbs: ["Daniel Jones", "Drew Lock"],
      rbs: ["Devin Singletary"],
      wrs: ["Malik Nabers"],
      tes: ["Darren Waller"]
    }
  },
  "Philadelphia Eagles": {
    division: "NFC East",
    roster: {
      qbs: ["Jalen Hurts"],
      rbs: ["Saquon Barkley"],
      wrs: ["A.J. Brown", "DeVonta Smith"],
      tes: ["Dallas Goedert"]
    }
  },
  "Washington Commanders": {
    division: "NFC East",
    roster: {
      qbs: ["Jayden Daniels"],
      rbs: ["Brian Robinson Jr."],
      wrs: ["Terry McLaurin", "Jahan Dotson"],
      tes: ["Zach Ertz"]
    }
  },

  // NFC NORTH
  "Chicago Bears": {
    division: "NFC North",
    roster: {
      qbs: ["Caleb Williams"],
      rbs: ["D'Andre Swift"],
      wrs: ["D.J. Moore", "Keenan Allen", "Rome Odunze"],
      tes: ["Cole Kmet"]
    }
  },
  "Detroit Lions": {
    division: "NFC North",
    roster: {
      qbs: ["Jared Goff"],
      rbs: ["Jahmyr Gibbs", "David Montgomery"],
      wrs: ["Amon-Ra St. Brown", "Jameson Williams"],
      tes: ["Sam LaPorta"]
    }
  },
  "Green Bay Packers": {
    division: "NFC North",
    roster: {
      qbs: ["Jordan Love"],
      rbs: ["Josh Jacobs"],
      wrs: ["Christian Watson", "Romeo Doubs", "Jayden Reed"],
      tes: ["Tucker Kraft", "Luke Musgrave"]
    }
  },
  "Minnesota Vikings": {
    division: "NFC North",
    roster: {
      qbs: ["J.J. McCarthy"],
      rbs: ["Aaron Jones"],
      wrs: ["Justin Jefferson", "Jordan Addison"],
      tes: ["T.J. Hockenson"]
    }
  },

  // NFC SOUTH
  "Atlanta Falcons": {
    division: "NFC South",
    roster: {
      qbs: ["Kirk Cousins"],
      rbs: ["Bijan Robinson", "Tyler Allgeier"],
      wrs: ["Drake London", "Darnell Mooney"],
      tes: ["Kyle Pitts"]
    }
  },
  "Carolina Panthers": {
    division: "NFC South",
    roster: {
      qbs: ["Bryce Young"],
      rbs: ["Jonathon Brooks"],
      wrs: ["Adam Thielen", "Diontae Johnson"],
      tes: ["Ja'Tavion Sanders"]
    }
  },
  "New Orleans Saints": {
    division: "NFC South",
    roster: {
      qbs: ["Derek Carr"],
      rbs: ["Alvin Kamara"],
      wrs: ["Chris Olave", "Rashid Shaheed"],
      tes: ["Juwan Johnson"]
    }
  },
  "Tampa Bay Buccaneers": {
    division: "NFC South",
    roster: {
      qbs: ["Baker Mayfield"],
      rbs: ["Rachaad White"],
      wrs: ["Mike Evans", "Chris Godwin"],
      tes: ["Cade Otton"]
    }
  },

  // NFC WEST
  "Arizona Cardinals": {
    division: "NFC West",
    roster: {
      qbs: ["Kyler Murray"],
      rbs: ["James Conner"],
      wrs: ["Marvin Harrison Jr."],
      tes: ["Trey McBride"]
    }
  },
  "Los Angeles Rams": {
    division: "NFC West",
    roster: {
      qbs: ["Matthew Stafford"],
      rbs: ["Kyren Williams"],
      wrs: ["Cooper Kupp", "Puka Nacua"],
      tes: ["Tyler Higbee"]
    }
  },
  "San Francisco 49ers": {
    division: "NFC West",
    roster: {
      qbs: ["Brock Purdy"],
      rbs: ["Christian McCaffrey"],
      wrs: ["Deebo Samuel", "Brandon Aiyuk"],
      tes: ["George Kittle"]
    }
  },
  "Seattle Seahawks": {
    division: "NFC West",
    roster: {
      qbs: ["Geno Smith"],
      rbs: ["Kenneth Walker III"],
      wrs: ["D.K. Metcalf", "Tyler Lockett"],
      tes: ["Noah Fant"]
    }
  }
};

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Game</title>
    <!-- Tailwind CSS CDN for easy and fast styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply a default font and dark background for the whole page */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* bg-gray-900 */
            color: #e2e8f0; /* text-gray-200 */
        }
        /* Style the main container to center the content on the screen */
        .game-container {
            max-width: 640px;
            margin: auto;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .game-display {
            width: 100%;
            height: 70vh; /* Adjust height as needed */
            border-radius: 0.75rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            background-color: #2f855a; /* A nice green for the field */
            padding: 1rem;
            position: relative;
        }

        /* Styles for the game elements */
        .field {
            width: 100%;
            height: 100%;
            background-image: repeating-linear-gradient(to right, #2f855a, #2f855a 10%, #38a169 10%, #38a169 20%);
            position: relative;
            border-top: 5px solid white;
            border-bottom: 5px solid white;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .yard-line {
            height: 100%;
            width: 2px;
            background-color: white;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .ball-marker {
            width: 10px;
            height: 10px;
            background-color: yellow;
            border-radius: 50%;
            position: absolute;
            bottom: 50%;
            transform: translateY(50%);
            left: calc(50% + 50%); /* Start at the 50-yard line */
            z-index: 10;
        }

        .line-of-scrimmage {
            height: 100%;
            width: 2px;
            background-color: red;
            position: absolute;
            z-index: 5;
        }
        
        .first-down-marker {
            height: 100%;
            width: 2px;
            background-color: yellow;
            position: absolute;
            z-index: 5;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0.5rem;
            background-color: rgba(0,0,0,0.5);
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 1.5rem;
        }
        
        .score-board .team-score {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .play-by-play-log {
            height: 100px;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.3);
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-top: 1rem;
        }
        .play-by-play-log p {
            font-size: 0.9rem;
            line-height: 1.2;
            margin-bottom: 0.2rem;
        }

        /* Style for the simple modal message box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: fadeInOut 3s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-900">

    <!-- Main container for the game's UI -->
    <div class="game-container">

        <!-- Main Menu Screen (Visible by default) -->
        <div id="main-menu" class="w-full text-center">
            <h1 class="text-5xl md:text-6xl font-extrabold text-white text-center mb-10">
                <span class="text-indigo-400">Football</span> Game
            </h1>

            <div class="w-full flex flex-col gap-4">
                <!-- Main "Quick Play" game button -->
                <button
                    id="play-football-btn"
                    class="py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Quick Play
                </button>
                <!-- New "Franchise" button -->
                <button
                    id="franchise-btn"
                    class="py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Franchise
                </button>
                <!-- This button will be shown only if a game is saved -->
                <button
                    id="load-game-btn"
                    class="py-4 px-6 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg shadow-md transition duration-200 hidden"
                >
                    Load Last Game
                </button>
            </div>
            
            <!-- TalkBack enable/disable option -->
            <div class="flex items-center justify-center mt-6">
                <input type="checkbox" id="talkback-toggle" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                <label for="talkback-toggle" class="ml-2 block text-sm text-gray-400">
                    Enable TalkBack
                </label>
            </div>
        </div>
        
        <!-- Quick Play Screen (Hidden by default) -->
        <div id="quick-play-menu" class="w-full text-center hidden">
             <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Choose Your Team
            </h2>
            
            <!-- Back to Menu button for the Quick Play screen -->
            <button
                id="back-to-menu-from-quick-play-btn"
                class="py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Main Menu
            </button>
            
            <!-- Teams list (for TalkBack accessibility) -->
            <ul id="teams-list" class="mt-8 grid grid-cols-2 gap-4">
                <!-- Teams will be populated here -->
            </ul>
        </div>
        
        <!-- Quick Play Saved Game Options (Hidden by default) -->
        <div id="quick-play-saved-game-options" class="w-full text-center hidden">
            <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Game Found
            </h2>
            <p class="text-gray-400 mb-6">A saved game was found. What would you like to do?</p>
            <div class="w-full flex flex-col gap-4">
                <button
                    id="resume-game-btn"
                    class="py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Resume Game
                </button>
                <button
                    id="delete-game-btn"
                    class="py-4 px-6 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Delete Game
                </button>
            </div>
            <button
                id="back-to-menu-from-saved-options"
                class="mt-6 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Main Menu
            </button>
        </div>


        <!-- Franchise Menu (Hidden by default) -->
        <div id="franchise-menu" class="w-full text-center hidden">
            <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Franchise Mode
            </h2>
            
            <div class="w-full flex flex-col gap-4">
                <div class="flex flex-row gap-4 items-center">
                    <!-- Dropdown for saved franchises (initially empty) -->
                    <select id="franchise-saves-select" class="flex-grow py-3 px-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <!-- Options will be dynamically added here -->
                        <option value="" disabled selected>No saved franchises</option>
                    </select>
                    <!-- Create New League button -->
                    <button
                        id="create-new-league-btn"
                        class="py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                    >
                        Create New League
                    </button>
                </div>
            </div>

            <!-- Back to Main Menu button -->
            <button
                id="back-to-menu-from-franchise-btn"
                class="mt-6 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Main Menu
            </button>
        </div>

        <!-- New League Menu (Hidden by default) -->
        <div id="new-league-menu" class="w-full text-center hidden">
            <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Create New League
            </h2>

            <div class="w-full flex flex-col gap-4">
                <!-- Roster options using buttons -->
                <button id="roster-live-real-life" class="py-4 px-6 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition duration-200">
                    Live Real Life Roster
                </button>
                <button id="roster-live-active" class="py-4 px-6 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition duration-200">
                    Live Active Roster
                </button>
                <button id="roster-offline-preseason" class="py-4 px-6 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition duration-200">
                    Offline Preseason Roster
                </button>
                <button id="roster-offline-active" class="py-4 px-6 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition duration-200">
                    Offline Active Roster
                </button>
            </div>

            <!-- Back to Franchise Menu button -->
            <button
                id="back-to-franchise-btn"
                class="mt-6 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Franchise Mode
            </button>
        </div>

        <!-- Franchise Team Select Menu (Hidden by default) -->
        <div id="franchise-team-select-menu" class="w-full text-center hidden">
            <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Choose Your Team
            </h2>
            <p class="mb-4 text-gray-400">Loading roster...</p>
            <!-- Back to New League Menu button -->
            <button
                id="back-to-new-league-btn"
                class="py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Roster Select
            </button>
            
            <!-- Teams list will be populated here -->
            <ul id="franchise-teams-list" class="mt-8 grid grid-cols-2 gap-4">
            </ul>
        </div>
        
        <!-- Franchise Customization Menu (Hidden by default) -->
        <div id="customize-franchise-menu" class="w-full text-center hidden">
            <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Customize Franchise
            </h2>
            
            <div class="w-full flex flex-col gap-6 p-4 bg-gray-800 rounded-lg shadow-md">
                <!-- Starting Point Combo Box -->
                <div class="flex flex-col">
                    <label for="starting-point-select" class="text-lg text-gray-400 text-left">Starting Point</label>
                    <select id="starting-point-select" class="w-full py-3 px-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="preseason">Preseason</option>
                        <option value="regular">Regular Season</option>
                        <option value="fantasy-draft">Fantasy Draft</option>
                    </select>
                </div>
            </div>
            
            <button
                id="start-playing-btn"
                class="mt-6 py-4 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Start Playing
            </button>

            <!-- Back to Franchise Team Select button -->
            <button
                id="back-to-franchise-team-select-btn"
                class="mt-4 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Team Select
            </button>
        </div>
        
        <!-- Game Settings Screen (Hidden by default) -->
        <div id="game-settings-menu" class="w-full text-center hidden">
            <h2 class="text-4xl md:text-5xl font-bold text-white text-center mb-6">
                Game Settings
            </h2>
            
            <div class="w-full flex flex-col gap-6 p-4 bg-gray-800 rounded-lg shadow-md">
                <!-- Quarter Length Slider -->
                <div class="flex flex-col">
                    <label for="quarter-length" class="text-lg text-gray-400 text-left">Quarter Length: <span id="quarter-length-value">15</span> min</label>
                    <input type="range" id="quarter-length" min="1" max="60" value="15" class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-gray-700">
                </div>

                <!-- Game Time Slider -->
                <div class="flex flex-col">
                    <label for="game-time" class="text-lg text-gray-400 text-left">Game Time: <span id="game-time-value">12:00</span></label>
                    <input type="range" id="game-time" min="0" max="720" value="720" class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-gray-700">
                </div>

                <!-- Weather Options Dropdown -->
                <div class="flex flex-col">
                    <label for="weather-select" class="text-lg text-gray-400 text-left">Weather Options</label>
                    <select id="weather-select" class="w-full py-3 px-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="clear">Clear</option>
                        <option value="cloudy">Cloudy</option>
                        <option value="partly-cloudy">Partly Cloudy</option>
                        <option value="overcast">Overcast</option>
                        <option value="sunny">Sunny</option>
                        <option value="rain">Rain</option>
                        <option value="heavy-rain">Heavy Rain</option>
                        <option value="snow">Snow</option>
                        <option value="heavy-snow">Heavy Snow</option>
                    </select>
                </div>

                <!-- Event Type Dropdown -->
                <div class="flex flex-col">
                    <label for="event-type-select" class="text-lg text-gray-400 text-left">Event Type</label>
                    <select id="event-type-select" class="w-full py-3 px-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="preseason">Preseason</option>
                        <option value="regular">Regular Season</option>
                        <option value="playoffs">Playoffs</option>
                        <option value="superbowl">Super Bowl</option>
                    </select>
                </div>
                
                <!-- Game Style Options Dropdown -->
                <div class="flex flex-col">
                    <label for="game-style-select" class="text-lg text-gray-400 text-left">Game Style Options</label>
                    <select id="game-style-select" class="w-full py-3 px-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        <option value="simulation">Simulation</option>
                        <option value="competitive">Competitive</option>
                        <option value="arcade">Arcade</option>
                    </select>
                </div>
            </div>
            
            <button
                id="start-quick-play-btn"
                class="mt-6 py-4 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Start Game
            </button>
            <button
                id="back-to-quick-play-btn"
                class="mt-4 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
            >
                Back to Team Select
            </button>
        </div>
        
        <!-- Game Screen (Hidden by default) -->
        <div id="game-screen" class="w-full text-center hidden">
            <h2 id="game-title" class="text-3xl font-bold mb-4"></h2>
            <div class="game-display bg-gray-800 rounded-xl shadow-lg mb-4">
                <!-- Scoreboard at the top -->
                <div class="score-board w-full flex justify-between p-2 rounded-t-lg">
                    <div class="flex flex-col items-center">
                        <span id="away-team-name" class="font-bold text-lg">AWAY</span>
                        <span id="away-score" class="text-3xl">0</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="flex items-center space-x-2">
                            <span id="quarter" class="text-xl">Q1</span>
                            <span id="game-clock" class="text-xl">15:00</span>
                        </div>
                        <span id="down-distance" class="text-lg">1st & 10</span>
                        <span id="ball-on" class="text-base">BALL ON: 50</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span id="home-team-name" class="font-bold text-lg">HOME</span>
                        <span id="home-score" class="text-3xl">0</span>
                    </div>
                </div>

                <!-- Field visualization area -->
                <div class="field my-4 relative">
                    <div id="ball-marker" class="absolute h-4 w-4 rounded-full bg-yellow-400 transition-all duration-300"></div>
                    <div id="line-of-scrimmage-marker" class="absolute h-full w-1 bg-red-500 opacity-70 transition-all duration-300"></div>
                    <div id="first-down-marker" class="absolute h-full w-1 bg-yellow-400 opacity-70 transition-all duration-300"></div>
                </div>

                <!-- Play-by-play log and TalkBack container -->
                <div class="play-by-play-log w-full h-24 overflow-y-auto bg-gray-700 rounded-lg p-2 text-sm text-gray-200">
                    <p id="talkback-output" class="mb-2"></p>
                    <p>Welcome to the game!</p>
                </div>
            </div>
            
            <!-- Offensive Playbook -->
            <div id="offensive-playbook" class="w-full flex flex-col gap-2 mt-4">
                <h3 class="text-xl font-bold mb-2">Offensive Playbook</h3>
                <div class="grid grid-cols-2 gap-2">
                    <button id="run-play-btn" class="py-3 px-6 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition duration-200 hidden">Run</button>
                    <button id="short-pass-btn" class="py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition duration-200 hidden">Short Pass</button>
                    <button id="long-pass-btn" class="py-3 px-6 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition duration-200 hidden">Long Pass</button>
                    <button id="punt-play-btn" class="py-3 px-6 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-lg transition duration-200 hidden">Punt</button>
                    <button id="field-goal-btn" class="py-3 px-6 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg transition duration-200 hidden">Field Goal</button>
                    <button id="extra-point-btn" class="py-3 px-6 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg transition duration-200 hidden">Extra Point</button>
                    <button id="two-point-conversion-btn" class="py-3 px-6 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-lg transition duration-200 hidden">2-Point Conversion</button>
                </div>
            </div>

            <!-- Halftime/Post-Game Screen -->
            <div id="halftime-screen" class="w-full text-center hidden">
                <h2 id="halftime-title" class="text-4xl font-bold mb-4">HALFTIME</h2>
                <p id="halftime-score" class="text-2xl mb-4"></p>
                <button id="start-second-half-btn" class="py-4 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-md transition duration-200">Start Second Half</button>
            </div>
            
            <div id="post-game-screen" class="w-full text-center hidden">
                <h2 class="text-4xl font-bold mb-4">GAME OVER</h2>
                <p id="final-score" class="text-2xl mb-4"></p>
                <p id="game-summary" class="text-lg text-gray-400 mb-4"></p>
                <button
                    id="back-to-menu-from-game-end-btn"
                    class="py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Back to Main Menu
                </button>
            </div>


            <div class="flex flex-row justify-between w-full mt-4">
                <button
                    id="back-to-menu-from-game-btn"
                    class="py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Back to Menu
                </button>
                <button
                    id="save-game-btn"
                    class="py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition duration-200"
                >
                    Save Game
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ensure the script runs after the document is fully loaded
        document.addEventListener('DOMContentLoaded', () => {

            // Get references to the HTML elements
            const mainMenu = document.getElementById('main-menu');
            const quickPlayMenu = document.getElementById('quick-play-menu');
            const quickPlaySavedGameOptions = document.getElementById('quick-play-saved-game-options');
            const franchiseMenu = document.getElementById('franchise-menu');
            const newLeagueMenu = document.getElementById('new-league-menu');
            const franchiseTeamSelectMenu = document.getElementById('franchise-team-select-menu');
            const customizeFranchiseMenu = document.getElementById('customize-franchise-menu');
            const gameSettingsMenu = document.getElementById('game-settings-menu');
            const gameScreen = document.getElementById('game-screen');
            const halftimeScreen = document.getElementById('halftime-screen');
            const postGameScreen = document.getElementById('post-game-screen');
            const gameDisplay = document.querySelector('.game-display');
            
            // Game UI elements
            const awayTeamNameEl = document.getElementById('away-team-name');
            const awayScoreEl = document.getElementById('away-score');
            const homeTeamNameEl = document.getElementById('home-team-name');
            const homeScoreEl = document.getElementById('home-score');
            const quarterEl = document.getElementById('quarter');
            const gameClockEl = document.getElementById('game-clock');
            const downDistanceEl = document.getElementById('down-distance');
            const ballOnEl = document.getElementById('ball-on');
            const ballMarkerEl = document.getElementById('ball-marker');
            const lineOfScrimmageMarkerEl = document.getElementById('line-of-scrimmage-marker');
            const firstDownMarkerEl = document.getElementById('first-down-marker');
            const playbook = document.getElementById('offensive-playbook');
            const talkbackOutputEl = document.getElementById('talkback-output');
            
            // Play buttons
            const runPlayBtn = document.getElementById('run-play-btn');
            const shortPassBtn = document.getElementById('short-pass-btn');
            const longPassBtn = document.getElementById('long-pass-btn');
            const puntPlayBtn = document.getElementById('punt-play-btn');
            const fieldGoalBtn = document.getElementById('field-goal-btn');
            const extraPointBtn = document.getElementById('extra-point-btn');
            const twoPointConversionBtn = document.getElementById('two-point-conversion-btn');
            
            // Menu buttons
            const playFootballBtn = document.getElementById('play-football-btn');
            const franchiseBtn = document.getElementById('franchise-btn');
            const loadGameBtn = document.getElementById('load-game-btn');
            const resumeGameBtn = document.getElementById('resume-game-btn');
            const deleteGameBtn = document.getElementById('delete-game-btn');
            
            // New League Roster buttons
            const rosterLiveRealLifeBtn = document.getElementById('roster-live-real-life');
            const rosterLiveActiveBtn = document.getElementById('roster-live-active');
            const rosterOfflinePreseasonBtn = document.getElementById('roster-offline-preseason');
            const rosterOfflineActiveBtn = document.getElementById('roster-offline-active');
            
            const createNewLeagueBtn = document.getElementById('create-new-league-btn');
            
            // Back buttons
            const backToMenuFromQuickPlayBtn = document.getElementById('back-to-menu-from-quick-play-btn');
            const backToMenuFromSavedOptions = document.getElementById('back-to-menu-from-saved-options');
            const backToMenuFromFranchiseBtn = document.getElementById('back-to-menu-from-franchise-btn');
            const backToFranchiseBtn = document.getElementById('back-to-franchise-btn');
            const backToNewLeagueBtn = document.getElementById('back-to-new-league-btn');
            const backToFranchiseTeamSelectBtn = document.getElementById('back-to-franchise-team-select-btn');
            const backToMenuFromGameBtn = document.getElementById('back-to-menu-from-game-btn');
            const backToQuickPlayBtn = document.getElementById('back-to-quick-play-btn');

            const startPlayingBtn = document.getElementById('start-playing-btn');
            const startQuickPlayBtn = document.getElementById('start-quick-play-btn');
            const startSecondHalfBtn = document.getElementById('start-second-half-btn');
            const backToMenuFromGameEndBtn = document.getElementById('back-to-menu-from-game-end-btn');
            const talkbackToggle = document.getElementById('talkback-toggle');

            const teamsList = document.getElementById('teams-list');
            const franchiseTeamsList = document.getElementById('franchise-teams-list');
            const saveGameBtn = document.getElementById('save-game-btn');

            const quarterLengthInput = document.getElementById('quarter-length');
            const quarterLengthValue = document.getElementById('quarter-length-value');
            const gameTimeInput = document.getElementById('game-time');
            const gameTimeValue = document.getElementById('game-time-value');
            const startingPointSelect = document.getElementById('starting-point-select');
            
            // Game state object
            let gameState = {};
            const playerNames = ['Christian McCaffrey', 'Patrick Mahomes', 'Tyreek Hill', 'Jalen Hurts', 'Cooper Kupp'];
            let gameClockInterval = null;
            let talkbackEnabled = false;

            // A list to hold the last saved game
            let lastSavedGame = null;

            // List of all 32 NFL teams
            const nflTeams = [
                'San Francisco 49ers', 'Arizona Cardinals', 'Atlanta Falcons', 'Baltimore Ravens', 'Buffalo Bills', 'Carolina Panthers',
                'Chicago Bears', 'Cincinnati Bengals', 'Cleveland Browns', 'Dallas Cowboys', 'Denver Broncos', 'Detroit Lions',
                'Green Bay Packers', 'Houston Texans', 'Indianapolis Colts', 'Jacksonville Jaguars', 'Kansas City Chiefs', 'Los Angeles Chargers',
                'Los Angeles Rams', 'Las Vegas Raiders', 'Miami Dolphins', 'Minnesota Vikings', 'New England Patriots', 'New Orleans Saints',
                'New York Giants', 'New York Jets', 'Philadelphia Eagles', 'Pittsburgh Steelers', 'Seattle Seahawks', 'Tampa Bay Buccaneers',
                'Tennessee Titans', 'Washington Commanders'
            ];
            
            // A list of all the main screen elements for centralized control
            const allScreens = [
                mainMenu, quickPlayMenu, quickPlaySavedGameOptions, franchiseMenu, newLeagueMenu,
                franchiseTeamSelectMenu, customizeFranchiseMenu, gameSettingsMenu,
                gameScreen, halftimeScreen, postGameScreen
            ];

            /**
             * Central function to hide all screens and show a specific one.
             * @param {HTMLElement} screenToShow The element to make visible.
             */
            const showScreen = (screenToShow) => {
                allScreens.forEach(screen => {
                    screen.classList.add('hidden');
                });
                if (screenToShow) {
                    screenToShow.classList.remove('hidden');
                }
            };
            
            // Helper function to show messages
            const showMessage = (message, type = 'success') => {
                const msgBox = document.createElement('div');
                msgBox.textContent = message;
                let bgColor = '';
                if (type === 'success') {
                    bgColor = 'bg-green-500';
                } else if (type === 'error') {
                    bgColor = 'bg-red-500';
                } else {
                    bgColor = 'bg-blue-500';
                }
                msgBox.className = `message-box ${bgColor} text-white`;
                document.body.appendChild(msgBox);
                setTimeout(() => msgBox.remove(), 3000);
            };

            /**
             * A simple "TalkBack" function to announce game events and log them.
             * @param {string} text The text to speak and display.
             */
            const announcePlay = (text) => {
                const logEl = document.getElementById('play-by-play-log');
                const p = document.createElement('p');
                p.textContent = text;
                
                // Only use TTS if the toggle is enabled
                if (talkbackEnabled) {
                    console.log("TalkBack:", text);
                    const utterance = new SpeechSynthesisUtterance(text);
                    speechSynthesis.speak(utterance);
                }

                talkbackOutputEl.textContent = text;
                // Add the new message to the top of the log
                const playLogContainer = document.querySelector('.play-by-play-log');
                const newLogEntry = document.createElement('p');
                newLogEntry.textContent = text;
                if (playLogContainer.children.length > 0) {
                    playLogContainer.insertBefore(newLogEntry, playLogContainer.children[0]);
                } else {
                    playLogContainer.appendChild(newLogEntry);
                }
            };

            /**
             * Renders the NFL teams list for Quick Play.
             */
            const renderTeamsList = (listElement, onTeamSelect) => {
                listElement.innerHTML = '';
                nflTeams.forEach(team => {
                    const li = document.createElement('li');
                    const button = document.createElement('button');
                    button.textContent = team;
                    button.className = 'py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg w-full text-center transition duration-200';
                    button.setAttribute('data-team', team);
                    button.addEventListener('click', () => {
                        onTeamSelect(team);
                    });
                    li.appendChild(button);
                    listElement.appendChild(li);
                });
            };

            /**
             * Loads last saved game from the browser's local storage.
             */
            const loadLastGameData = () => {
                const savedState = localStorage.getItem('lastSavedGame');
                if (savedState) {
                    lastSavedGame = JSON.parse(savedState);
                    loadGameBtn.classList.remove('hidden');
                } else {
                    lastSavedGame = null;
                    loadGameBtn.classList.add('hidden');
                }
            };

            /**
             * Saves the last saved game to the browser's local storage.
             */
            const saveGameData = () => {
                if (gameState.isGameActive) {
                    localStorage.setItem('lastSavedGame', JSON.stringify(gameState));
                    showMessage('Game saved!', 'success');
                    loadLastGameData();
                } else {
                    showMessage('No active game to save!', 'error');
                }
            };
            
            /**
             * Deletes the saved game from local storage.
             */
            const deleteSavedGame = () => {
                localStorage.removeItem('lastSavedGame');
                lastSavedGame = null;
                showMessage('Saved game deleted!', 'success');
                loadLastGameData();
                showScreen(quickPlayMenu);
            };
            
            /**
             * A new function to centrally control the visibility of all playbook buttons.
             * This ensures the UI always matches the game state.
             */
            const renderPlaybook = () => {
                // Hide all buttons by default
                const allPlayButtons = [runPlayBtn, shortPassBtn, longPassBtn, puntPlayBtn, fieldGoalBtn, extraPointBtn, twoPointConversionBtn];
                allPlayButtons.forEach(btn => btn.classList.add('hidden'));

                // Show buttons based on the current game state
                if (gameState.isTouchdown) {
                    extraPointBtn.classList.remove('hidden');
                    twoPointConversionBtn.classList.remove('hidden');
                } else if (gameState.down === 4) {
                    puntPlayBtn.classList.remove('hidden');
                    // Only allow field goal if they are within reasonable range (e.g., inside 40 yard line)
                    if (gameState.offense === gameState.homeTeam && gameState.ballOn >= 60 || gameState.offense === gameState.awayTeam && gameState.ballOn <= 40) {
                         fieldGoalBtn.classList.remove('hidden');
                    }
                } else {
                    runPlayBtn.classList.remove('hidden');
                    shortPassBtn.classList.remove('hidden');
                    longPassBtn.classList.remove('hidden');
                }
            };

            /**
             * Formats seconds into MM:SS format.
             * @param {number} totalSeconds The total number of seconds.
             * @returns {string} Formatted string.
             */
            const formatTime = (totalSeconds) => {
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
                return `${minutes}:${formattedSeconds}`;
            };

            /**
             * Starts the game clock countdown.
             */
            const startClock = () => {
                // Clear any existing interval to prevent multiple timers
                if (gameClockInterval) clearInterval(gameClockInterval);
                
                gameClockInterval = setInterval(() => {
                    if (gameState.gameClock > 0) {
                        gameState.gameClock--;
                        gameClockEl.textContent = formatTime(gameState.gameClock);
                    } else {
                        // Clock hit zero, advance quarter
                        endQuarter();
                    }
                }, 1000); // Update every second
            };

            /**
             * Pauses the game clock.
             */
            const pauseClock = () => {
                if (gameClockInterval) {
                    clearInterval(gameClockInterval);
                    gameClockInterval = null;
                }
            };
            
            /**
             * Ends the current quarter and advances to the next one.
             */
            const endQuarter = () => {
                 pauseClock(); // Stop the clock
                 gameState.quarter++;
                 
                 if (gameState.quarter > 4) {
                     endGame();
                 } else if (gameState.quarter === 3) {
                     gameState.isHalftime = true;
                     announcePlay("Halftime! The teams are heading to the locker room.");
                     showScreen(halftimeScreen);
                 } else {
                     announcePlay(`End of Quarter ${gameState.quarter - 1}. Starting Quarter ${gameState.quarter}.`);
                     gameState.gameClock = gameState.quarterLength * 60; // Reset clock for new quarter
                     updateGameUI();
                     startClock();
                 }
            };

            /**
             * Updates the game UI based on the current state.
             */
            const updateGameUI = () => {
                awayTeamNameEl.textContent = gameState.awayTeam;
                homeTeamNameEl.textContent = gameState.homeTeam;
                awayScoreEl.textContent = gameState.awayScore;
                homeScoreEl.textContent = gameState.homeScore;
                quarterEl.textContent = `Q${gameState.quarter}`;
                gameClockEl.textContent = formatTime(gameState.gameClock);
                downDistanceEl.textContent = `${gameState.down} & ${gameState.distance}`;
                ballOnEl.textContent = `BALL ON: ${gameState.ballOn}`;
                
                // Position the ball and markers visually
                const fieldWidth = gameDisplay.offsetWidth;
                let ballPosition;
                if (gameState.offense === gameState.homeTeam) {
                    // Ball is on the home side, counting up from 0 to 50
                    ballPosition = (fieldWidth / 2) + (fieldWidth / 2) * (gameState.ballOn / 50);
                } else {
                    // Ball is on the away side, counting down from 100 to 50
                    ballPosition = (fieldWidth / 2) - (fieldWidth / 2) * ((100 - gameState.ballOn) / 50);
                }
                ballMarkerEl.style.left = `${ballPosition}px`;
                lineOfScrimmageMarkerEl.style.left = `${ballPosition}px`;

                let firstDownPosition;
                const firstDownYardLine = gameState.ballOn + gameState.distance;
                 if (gameState.offense === gameState.homeTeam) {
                    firstDownPosition = (fieldWidth / 2) + (fieldWidth / 2) * (firstDownYardLine / 50);
                } else {
                    firstDownPosition = (fieldWidth / 2) - (fieldWidth / 2) * ((100 - firstDownYardLine) / 50);
                }
                firstDownMarkerEl.style.left = `${firstDownPosition}px`;


                // Update play button visibility using the new central function
                renderPlaybook();
            };

            /**
             * Advances the game state after a play.
             * @param {number} yardsGained The yards gained on the play.
             */
            const advanceGame = (yardsGained) => {
                if (gameState.isHalftime) {
                    showScreen(halftimeScreen);
                    return;
                }

                // Check for Touchdown before updating yards
                if (gameState.ballOn + yardsGained >= 100) {
                     scoreTouchdown();
                     return;
                }

                gameState.ballOn += yardsGained;
                gameState.yardsToGain -= yardsGained;
                
                // Check for first down
                if (gameState.yardsToGain <= 0) {
                    announcePlay(`First down!`);
                    gameState.down = 1;
                    gameState.yardsToGain = 10;
                } else {
                    gameState.down++;
                }
                
                // Check for turnover on downs
                if (gameState.down > 4) {
                    announcePlay(`Turnover on downs! The ${gameState.defense} take over.`);
                    // Switch teams
                    const tempTeam = gameState.offense;
                    gameState.offense = gameState.defense;
                    gameState.defense = tempTeam;
                    // Reset down and distance
                    gameState.down = 1;
                    gameState.yardsToGain = 10;
                }
                
                updateGameUI();
            };

            /**
             * Simulates a running play. Runs are way more effective than other plays.
             */
            const runPlay = () => {
                const yards = Math.floor(Math.random() * 20) + 1; // More effective
                const player = playerNames[Math.floor(Math.random() * playerNames.length)];
                announcePlay(`${player} runs for ${yards} yards! The ball is now on the ${gameState.ballOn + yards} yard line.`);
                advanceGame(yards);
            };

            /**
             * Simulates a short pass.
             */
            const shortPassPlay = () => {
                const yards = Math.floor(Math.random() * 8) + 1;
                const player = playerNames[Math.floor(Math.random() * playerNames.length)];
                announcePlay(`${player} catches a short pass for ${yards} yards. The ball is now on the ${gameState.ballOn + yards} yard line.`);
                advanceGame(yards);
            };

            /**
             * Simulates a long pass. Can be a huge gain or an incomplete.
             */
            const longPassPlay = () => {
                const outcome = Math.random();
                if (outcome > 0.5) { // 50% chance of completion
                    const yards = Math.floor(Math.random() * 30) + 10;
                    const player = playerNames[Math.floor(Math.random() * playerNames.length)];
                    announcePlay(`A long pass is completed to ${player} for ${yards} yards! The ball is now on the ${gameState.ballOn + yards} yard line.`);
                    advanceGame(yards);
                } else {
                    const message = outcome > 0.2 ? 'incomplete' : 'intercepted';
                    announcePlay(`The long pass is ${message}. The ball is still on the ${gameState.ballOn} yard line.`);
                    if (message === 'intercepted') {
                        // Switch teams
                        const tempTeam = gameState.offense;
                        gameState.offense = gameState.defense;
                        gameState.defense = tempTeam;
                        gameState.down = 1;
                        gameState.yardsToGain = 10;
                    } else {
                        gameState.down++;
                    }
                }
                updateGameUI();
            };

            /**
             * Simulates a punt.
             */
            const puntPlay = () => {
                 const yards = Math.floor(Math.random() * 20) + 30; // 30-50 yard punt
                 const newBallOn = gameState.ballOn + yards;
                 announcePlay(`The ${gameState.offense} punts for ${yards} yards. The ball is now on the ${newBallOn} yard line.`);
                 // Switch teams and set up for next play
                 const tempTeam = gameState.offense;
                 gameState.offense = gameState.defense;
                 gameState.defense = tempTeam;
                 gameState.ballOn = newBallOn;
                 gameState.down = 1;
                 gameState.yardsToGain = 10;
                 updateGameUI();
            };
            
            /**
             * Simulates a field goal attempt.
             */
            const fieldGoalPlay = () => {
                const distance = 100 - gameState.ballOn;
                const outcome = Math.random();
                // Logic for field goal success based on distance
                if (distance < 50 && outcome > 0.2 || distance >= 50 && outcome > 0.7) {
                    announcePlay(`The ${gameState.offense} field goal attempt is good!`);
                    scoreFieldGoal();
                } else {
                    announcePlay(`The ${gameState.offense} field goal is no good!`);
                    // Turn over on downs
                    const tempTeam = gameState.offense;
                    gameState.offense = gameState.defense;
                    gameState.defense = tempTeam;
                    gameState.ballOn = gameState.ballOn; // Ball stays at spot of missed kick
                    gameState.down = 1;
                    gameState.yardsToGain = 10;
                    updateGameUI();
                }
            };
            
            /**
             * Handles scoring a touchdown.
             */
            const scoreTouchdown = () => {
                gameState.isTouchdown = true;
                announcePlay(`TOUCHDOWN! The ${gameState.offense} scores!`);
                
                // Update score and game state
                if (gameState.offense === gameState.homeTeam) {
                    gameState.homeScore += 6;
                } else {
                    gameState.awayScore += 6;
                }
                updateGameUI();
            };
            
            /**
             * Handles scoring an extra point.
             */
            const scoreExtraPoint = () => {
                const outcome = Math.random();
                if (outcome > 0.1) {
                    if (gameState.offense === gameState.homeTeam) {
                        gameState.homeScore += 1;
                    } else {
                        gameState.awayScore += 1;
                    }
                    announcePlay(`The extra point is good! The score is now ${gameState.homeTeam} ${gameState.homeScore}, and ${gameState.awayTeam} ${gameState.awayScore}.`);
                } else {
                    announcePlay('The extra point is no good!');
                }
                endScoringPlay();
            };
            
            /**
             * Handles a two-point conversion attempt.
             */
            const scoreTwoPointConversion = () => {
                const outcome = Math.random();
                if (outcome > 0.5) { // 50% chance of success
                    if (gameState.offense === gameState.homeTeam) {
                        gameState.homeScore += 2;
                    } else {
                        gameState.awayScore += 2;
                    }
                    announcePlay(`The two-point conversion is good! The score is now ${gameState.homeTeam} ${gameState.homeScore}, and ${gameState.awayTeam} ${gameState.awayScore}.`);
                } else {
                    announcePlay('The two-point conversion is no good!');
                }
                endScoringPlay();
            };
            
            /**
             * Resets the game state after a touchdown scoring play.
             */
            const endScoringPlay = () => {
                gameState.isTouchdown = false;
                // Switch teams and reset down/distance for the next kickoff
                const tempTeam = gameState.offense;
                gameState.offense = gameState.defense;
                gameState.defense = tempTeam;
                gameState.ballOn = 50; // Ball starts at midfield after a score
                gameState.down = 1;
                gameState.yardsToGain = 10;
                
                updateGameUI();
            };

            /**
             * Handles scoring a field goal.
             */
            const scoreFieldGoal = () => {
                if (gameState.offense === gameState.homeTeam) {
                    gameState.homeScore += 3;
                } else {
                    gameState.awayScore += 3;
                }
                announcePlay(`The score is now ${gameState.homeTeam} ${gameState.homeScore}, and ${gameState.awayTeam} ${gameState.awayScore}.`);
                // Switch teams and reset for next possession
                const tempTeam = gameState.offense;
                gameState.offense = gameState.defense;
                gameState.defense = tempTeam;
                gameState.ballOn = 50; // Ball starts at midfield after a score
                gameState.down = 1;
                gameState.yardsToGain = 10;
                updateGameUI();
            };
            
            /**
             * Ends the game and shows the post-game screen.
             */
            const endGame = () => {
                pauseClock();
                gameState.isGameActive = false;
                showScreen(postGameScreen);
                const winningTeam = gameState.homeScore > gameState.awayScore ? gameState.homeTeam : gameState.awayTeam;
                const losingTeam = winningTeam === gameState.homeTeam ? gameState.awayTeam : gameState.homeTeam;
                const finalScoreText = `${gameState.homeTeam} ${gameState.homeScore} - ${gameState.awayTeam} ${gameState.awayScore}`;
                const summaryText = `${winningTeam} defeats ${losingTeam} in a close game!`;
                
                document.getElementById('final-score').textContent = finalScoreText;
                document.getElementById('game-summary').textContent = summaryText;
                announcePlay(`Game over! The final score is ${finalScoreText}.`);
            };


            /**
             * Starts a new game.
             * @param {string} homeTeam The name of the home team.
             * @param {string} awayTeam The name of the away team.
             */
            const newGame = (homeTeam, awayTeam) => {
                gameState = {
                    homeTeam: homeTeam,
                    awayTeam: awayTeam,
                    homeScore: 0,
                    awayScore: 0,
                    offense: homeTeam,
                    defense: awayTeam,
                    quarter: 1,
                    yardsToGain: 10,
                    down: 1,
                    ballOn: 50, // 50-yard line
                    quarterLength: parseInt(quarterLengthInput.value),
                    gameClock: parseInt(quarterLengthInput.value) * 60,
                    isGameActive: true,
                    isTouchdown: false,
                    isHalftime: false
                };
                
                showScreen(gameScreen);
                updateGameUI();
                startClock();
                saveGameData(); // Save the game immediately when starting
                announcePlay(`Welcome to the game! The ${gameState.offense} have the ball on their own 50 yard line.`);
            };

            /**
             * Handles loading a saved game.
             */
            const loadGame = () => {
                if (lastSavedGame) {
                    gameState = lastSavedGame;
                    gameState.isGameActive = true;
                    showScreen(gameScreen);
                    updateGameUI();
                    startClock();
                    announcePlay("Game loaded!");
                } else {
                    showMessage("No saved game found!", 'error');
                }
            };

            // Event listeners for main navigation
            playFootballBtn.addEventListener('click', () => {
                loadLastGameData();
                if (lastSavedGame) {
                    showScreen(quickPlaySavedGameOptions);
                } else {
                    showScreen(quickPlayMenu);
                }
            });
            franchiseBtn.addEventListener('click', () => showScreen(franchiseMenu));
            loadGameBtn.addEventListener('click', loadGame);
            
            // New Quick Play options for saved games
            resumeGameBtn.addEventListener('click', loadGame);
            deleteGameBtn.addEventListener('click', deleteSavedGame);
            backToMenuFromSavedOptions.addEventListener('click', () => showScreen(mainMenu));
            
            backToMenuFromQuickPlayBtn.addEventListener('click', () => showScreen(mainMenu));
            backToMenuFromFranchiseBtn.addEventListener('click', () => showScreen(mainMenu));
            backToMenuFromGameBtn.addEventListener('click', () => {
                gameState.isGameActive = false; // Stop the current game
                pauseClock(); // Stop the clock
                showScreen(mainMenu);
            });
            backToMenuFromGameEndBtn.addEventListener('click', () => showScreen(mainMenu));

            // Franchise navigation
            createNewLeagueBtn.addEventListener('click', () => showScreen(newLeagueMenu));
            backToFranchiseBtn.addEventListener('click', () => showScreen(franchiseMenu));
            
            // New League Roster buttons
            rosterLiveRealLifeBtn.addEventListener('click', () => {
                showScreen(franchiseTeamSelectMenu);
                showMessage('Importing Live Real Life Roster players...', 'success');
                renderTeamsList(franchiseTeamsList, () => showScreen(customizeFranchiseMenu));
            });
            rosterLiveActiveBtn.addEventListener('click', () => {
                showScreen(franchiseTeamSelectMenu);
                showMessage('Importing Live Active Roster players...', 'success');
                renderTeamsList(franchiseTeamsList, () => showScreen(customizeFranchiseMenu));
            });
            rosterOfflinePreseasonBtn.addEventListener('click', () => {
                showScreen(franchiseTeamSelectMenu);
                showMessage('Importing Offline Preseason Roster players...', 'success');
                renderTeamsList(franchiseTeamsList, () => showScreen(customizeFranchiseMenu));
            });
            rosterOfflineActiveBtn.addEventListener('click', () => {
                showScreen(franchiseTeamSelectMenu);
                showMessage('Importing Offline Active Roster players...', 'success');
                renderTeamsList(franchiseTeamsList, () => showScreen(customizeFranchiseMenu));
            });

            // Back button for Franchise Team Select
            backToNewLeagueBtn.addEventListener('click', () => showScreen(newLeagueMenu));

            // Back button for Franchise Customize
            backToFranchiseTeamSelectBtn.addEventListener('click', () => showScreen(franchiseTeamSelectMenu));

            // Start playing button from the new Franchise Customize menu
            startPlayingBtn.addEventListener('click', () => {
                const selectedStartingPoint = startingPointSelect.value;
                showMessage(`Starting franchise with ${selectedStartingPoint}...`, 'success');
                newGame('Home Team', 'Away Team'); // Start a new game with default teams
            });
            
            // Quick Play game settings and start
            startQuickPlayBtn.addEventListener('click', () => {
                // Get a random opponent
                const opponentTeam = nflTeams.filter(t => t !== gameState.selectedTeam)[Math.floor(Math.random() * (nflTeams.length - 1))];
                newGame(gameState.selectedTeam, opponentTeam);
            });
            backToQuickPlayBtn.addEventListener('click', () => showScreen(quickPlayMenu));

            // Gameplay button listeners
            runPlayBtn.addEventListener('click', runPlay);
            shortPassBtn.addEventListener('click', shortPassPlay);
            longPassBtn.addEventListener('click', longPassPlay);
            puntPlayBtn.addEventListener('click', puntPlay);
            fieldGoalBtn.addEventListener('click', fieldGoalPlay);
            extraPointBtn.addEventListener('click', scoreExtraPoint);
            twoPointConversionBtn.addEventListener('click', scoreTwoPointConversion);
            startSecondHalfBtn.addEventListener('click', () => {
                 gameState.isHalftime = false;
                 showScreen(gameScreen);
                 startClock();
                 announcePlay("Welcome back to the second half!");
                 updateGameUI();
            });

            // Save and load
            saveGameBtn.addEventListener('click', saveGameData);

            // Sliders for game settings
            quarterLengthInput.addEventListener('input', (event) => {
                quarterLengthValue.textContent = event.target.value;
            });
            gameTimeInput.addEventListener('input', (event) => {
                const minutes = Math.floor(event.target.value / 60);
                const seconds = event.target.value % 60;
                gameTimeValue.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            });
            
            // TalkBack toggle
            talkbackToggle.addEventListener('change', (event) => {
                talkbackEnabled = event.target.checked;
                showMessage(`TalkBack is now ${talkbackEnabled ? 'enabled' : 'disabled'}.`);
            });

            // Initial setup
            loadLastGameData();
            // Render teams for Quick Play menu
            renderTeamsList(teamsList, (selectedTeam) => {
                // This is the team the user selected. Now we show settings.
                const opponentTeam = nflTeams.filter(t => t !== selectedTeam)[Math.floor(Math.random() * (nflTeams.length - 1))];
                gameState.selectedTeam = selectedTeam;
                gameState.opponentTeam = opponentTeam;
                showScreen(gameSettingsMenu);
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Football Game State Demo</title>
  <!-- Load Tailwind CSS for simple, responsive styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Use Inter font for a clean look -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

  <!-- Main Game Container -->
  <div class="bg-gray-800 p-8 md:p-12 rounded-3xl shadow-2xl w-full max-w-2xl">
    <h1 class="text-3xl md:text-4xl font-bold text-center mb-6">Football Game</h1>
    <p class="text-center text-gray-400 mb-8">This example shows how to save and load your game state.</p>

    <!-- Game Information Display -->
    <div class="flex justify-around items-center mb-8">
      <div class="text-center">
        <h2 class="text-xl font-medium text-gray-300">Score</h2>
        <p id="score-display" class="text-5xl md:text-6xl font-extrabold text-green-400 mt-2">0</p>
      </div>
      <div class="text-center">
        <h2 class="text-xl font-medium text-gray-300">Quarter Length</h2>
        <p id="quarter-length-display" class="text-5xl md:text-6xl font-extrabold text-green-400 mt-2">15 min</p>
      </div>
    </div>

    <!-- Controls Container -->
    <div class="space-y-6">

      <!-- Score Controls -->
      <div class="flex flex-col sm:flex-row gap-4">
        <button id="add-score-btn" class="flex-1 bg-green-600 hover:bg-green-500 transition-all text-white font-bold py-4 rounded-xl shadow-lg">
          Add Touchdown (6 pts)
        </button>
      </div>

      <!-- Quarter Length Controls -->
      <div class="flex items-center gap-4">
        <label for="quarter-length-input" class="text-gray-300 whitespace-nowrap">Set Quarter Length (min):</label>
        <input type="number" id="quarter-length-input" value="15" min="1" max="60"
               class="flex-grow bg-gray-700 text-white px-4 py-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Save/Load Controls -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <button id="save-btn" class="bg-blue-600 hover:bg-blue-500 transition-all text-white font-bold py-4 rounded-xl shadow-lg">
          Save Game
        </button>
        <button id="load-btn" class="bg-purple-600 hover:bg-purple-500 transition-all text-white font-bold py-4 rounded-xl shadow-lg">
          Load Game
        </button>
      </div>
    </div>

    <!-- Status/Message Box -->
    <div id="status-box" class="mt-8 p-4 rounded-xl text-center font-medium transition-all duration-300"></div>
  </div>

  <script>
    // Get all the necessary HTML elements
    const scoreDisplay = document.getElementById('score-display');
    const quarterLengthDisplay = document.getElementById('quarter-length-display');
    const quarterLengthInput = document.getElementById('quarter-length-input');
    const addScoreBtn = document.getElementById('add-score-btn');
    const saveBtn = document.getElementById('save-btn');
    const loadBtn = document.getElementById('load-btn');
    const statusBox = document.getElementById('status-box');

    // Initialize game state variables
    let score = 0;
    let quarterLength = 15;

    /**
     * Updates the UI to show the current score and quarter length.
     */
    function updateUI() {
      scoreDisplay.textContent = score;
      quarterLengthDisplay.textContent = `${quarterLength} min`;
      quarterLengthInput.value = quarterLength;
    }

    /**
     * Displays a message in the status box with a specific style.
     * @param {string} message - The message to display.
     * @param {string} type - The type of message ('success', 'error', 'info').
     */
    function showStatus(message, type) {
      statusBox.textContent = message;
      statusBox.className = 'mt-8 p-4 rounded-xl text-center font-medium transition-all duration-300'; // Reset classes
      if (type === 'success') {
        statusBox.classList.add('bg-green-800', 'text-green-200', 'opacity-100');
      } else if (type === 'info') {
        statusBox.classList.add('bg-blue-800', 'text-blue-200', 'opacity-100');
      } else {
        statusBox.classList.add('bg-red-800', 'text-red-200', 'opacity-100');
      }

      // Hide the message after a few seconds
      setTimeout(() => {
        statusBox.classList.remove('opacity-100');
        statusBox.classList.add('opacity-0');
      }, 3000);
    }

    /**
     * Saves the current game state to localStorage.
     * This is the key to preventing the score and quarter length from resetting.
     */
    function saveGameState() {
      try {
        // Create an object to hold all the state variables
        const gameState = {
          score: score,
          quarterLength: quarterLength,
        };
        // Convert the object to a JSON string and save it with a key
        localStorage.setItem('footballGameState', JSON.stringify(gameState));
        showStatus('Game saved successfully!', 'success');
      } catch (error) {
        showStatus('Failed to save game.', 'error');
        console.error("Error saving game state:", error);
      }
    }

    /**
     * Loads the game state from localStorage.
     * This is what happens when you "load" a game.
     */
    function loadGameState() {
      try {
        const savedData = localStorage.getItem('footballGameState');
        if (savedData) {
          // Parse the JSON string back into a JavaScript object
          const gameState = JSON.parse(savedData);
          score = gameState.score;
          quarterLength = gameState.quarterLength;
          updateUI();
          showStatus('Game loaded successfully!', 'info');
        } else {
          showStatus('No saved game found.', 'error');
        }
      } catch (error) {
        showStatus('Failed to load game.', 'error');
        console.error("Error loading game state:", error);
      }
    }

    // --- Event Listeners ---
    
    // Listen for the "Add Touchdown" button click
    addScoreBtn.addEventListener('click', () => {
      score += 6;
      updateUI();
    });

    // Listen for the quarter length input change
    quarterLengthInput.addEventListener('input', (event) => {
      const newLength = parseInt(event.target.value, 10);
      if (!isNaN(newLength) && newLength > 0 && newLength <= 60) {
        quarterLength = newLength;
        updateUI();
      }
    });

    // Listen for the "Save Game" button click
    saveBtn.addEventListener('click', saveGameState);

    // Listen for the "Load Game" button click
    loadBtn.addEventListener('click', loadGameState);

    // --- Initial Load Logic ---

    // When the page first loads, check if there is a saved game to load automatically.
    // This solves the problem of the game resetting to 0 every time.
    document.addEventListener('DOMContentLoaded', () => {
      loadGameState();
    });

  </script>
</body>
</html>

