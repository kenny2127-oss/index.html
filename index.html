<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Adventure</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f0f0f0; }
  .tabs { display: flex; border-top: 2px solid #333; background: #fff; position: fixed; bottom: 0; width: 100%; }
  .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; outline: none; }
  .tab.selected { background: #ddd; font-weight: bold; }
  .tab-content { padding: 20px; margin-bottom: 60px; display: none; }
  .tab-content.active { display: block; }
  button { padding: 10px; margin: 5px; font-size: 16px; }
  .pokemon-item { margin-bottom: 5px; }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tab-content active" id="home-content">
  <h2>Home</h2>
  <button id="signup-btn-top">Sign Up</button>
  <button id="login-btn-top">Log In</button>
  <p>Welcome to Pokémon Adventure!</p>
</div>

<div class="tab-content" id="pokemon-content">
  <h2>Pokémon</h2>
  <div id="pokemon-list"></div>
</div>

<div class="tab-content" id="gather-content">
  <h2>Gather</h2>
  <button id="gather-btn">Gather Item</button>
  <div id="gather-result"></div>
</div>

<div class="tab-content" id="battle-content">
  <h2>Battle</h2>
  <button id="start-battle-btn">Start Battle</button>
  <div id="battle-log"></div>
</div>

<!-- Bottom Tabs -->
<div class="tabs" role="tablist">
  <div class="tab selected" role="tab" aria-selected="true" aria-controls="home-content">Home</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="pokemon-content">Pokémon</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="gather-content">Gather</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="battle-content">Battle</div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.25.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.25.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.25.0/firebase-firestore.js";

// --- 1. Initialize Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyDB4XhURDerrLIfb_PdcyDHiBhyzIqRxvY",
  authDomain: "pokemon-756e7.firebaseapp.com",
  projectId: "pokemon-756e7",
  storageBucket: "pokemon-756e7.appspot.com",
  messagingSenderId: "799827870179",
  appId: "1:799827870179:web:7cf9995a4c45469b02e0d6"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- 2. Tabs Navigation ---
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
  const showTab = () => {
    tabs.forEach(t => { t.classList.remove('selected'); t.setAttribute('aria-selected','false'); });
    tab.classList.add('selected'); tab.setAttribute('aria-selected','true');
    contents.forEach(c => c.classList.remove('active'));
    document.getElementById(tab.getAttribute('aria-controls')).classList.add('active');
  };
  tab.addEventListener('click', showTab);
});

// --- 3. Pokémon Data (simplified first 54) ---
const pokemonData = [
  {name:"Bulbasaur",type:"Grass/Poison",level:5,hp:45,attack:49,defense:49,speed:45,moves:[{name:"Tackle",power:40},{name:"Vine Whip",power:45}]},
  {name:"Ivysaur",type:"Grass/Poison",level:10,hp:60,attack:62,defense:63,speed:60,moves:[{name:"Tackle",power:40},{name:"Vine Whip",power:45}]},
  {name:"Venusaur",type:"Grass/Poison",level:20,hp:80,attack:82,defense:83,speed:80,moves:[{name:"Tackle",power:40},{name:"Vine Whip",power:45}]},
  {name:"Charmander",type:"Fire",level:5,hp:39,attack:52,defense:43,speed:65,moves:[{name:"Scratch",power:40},{name:"Ember",power:40}]},
  {name:"Charmeleon",type:"Fire",level:10,hp:58,attack:64,defense:58,speed:80,moves:[{name:"Scratch",power:40},{name:"Ember",power:40}]},
  {name:"Charizard",type:"Fire/Flying",level:20,hp:78,attack:84,defense:78,speed:100,moves:[{name:"Scratch",power:40},{name:"Ember",power:40}]},
  {name:"Squirtle",type:"Water",level:5,hp:44,attack:48,defense:65,speed:43,moves:[{name:"Tackle",power:40},{name:"Water Gun",power:40}]},
  {name:"Wartortle",type:"Water",level:10,hp:59,attack:63,defense:80,speed:58,moves:[{name:"Tackle",power:40},{name:"Water Gun",power:40}]},
  {name:"Blastoise",type:"Water",level:20,hp:79,attack:83,defense:100,speed:78,moves:[{name:"Tackle",power:40},{name:"Water Gun",power:40}]},
];

// Display Pokémon
const pokemonListDiv = document.getElementById('pokemon-list');
pokemonData.forEach(p => {
  const div = document.createElement('div');
  div.className = 'pokemon-item';
  div.textContent = `${p.name} - Type: ${p.type} - Level: ${p.level}`;
  pokemonListDiv.appendChild(div);
});

// --- 4. Gather System ---
const gatherBtn = document.getElementById('gather-btn');
const gatherResult = document.getElementById('gather-result');
const items = ["Pokéball","Potion","Rare Candy","Berry","Stone"];
let playerXP = 0;

gatherBtn.addEventListener('click', () => {
  const item = items[Math.floor(Math.random()*items.length)];
  playerXP += 10;
  gatherResult.textContent = `You gathered: ${item}! +10 XP (Total XP: ${playerXP})`;
});

// --- 5. Battle System ---
const startBattleBtn = document.getElementById('start-battle-btn');
const battleLog = document.getElementById('battle-log');

startBattleBtn.addEventListener('click', () => {
  const player = pokemonData[Math.floor(Math.random()*pokemonData.length)];
  const enemy = pokemonData[Math.floor(Math.random()*pokemonData.length)];
  let playerHP = player.hp;
  let enemyHP = enemy.hp;
  battleLog.innerHTML = `Battle Start! ${player.name} vs ${enemy.name}<br>`;

  const battleInterval = setInterval(() => {
    if(playerHP <= 0 || enemyHP <= 0){
      clearInterval(battleInterval);
      if(playerHP>0){ playerXP+=50; battleLog.innerHTML+=`<br>You won! +50 XP (Total XP: ${playerXP})`; }
      else battleLog.innerHTML+=`<br>You lost!`;
      return;
    }
    const playerMove = player.moves[Math.floor(Math.random()*player.moves.length)];
    enemyHP -= playerMove.power; if(enemyHP<0) enemyHP=0;
    battleLog.innerHTML += `${player.name} used ${playerMove.name}! Enemy HP: ${enemyHP}<br>`;
    if(enemyHP<=0) return;
    const enemyMove = enemy.moves[Math.floor(Math.random()*enemy.moves.length)];
    playerHP -= enemyMove.power; if(playerHP<0) playerHP=0;
    battleLog.innerHTML += `${enemy.name} used ${enemyMove.name}! Your HP: ${playerHP}<br>`;
  }, 1000);
});

// --- 6. Firebase Auth UI ---
const authDiv = document.createElement('div');
authDiv.id = 'auth-container';
authDiv.style.display = 'none';
authDiv.innerHTML = `
  <h3>Account</h3>
  <input type="email" id="auth-email" placeholder="Email" aria-label="Email" />
  <input type="password" id="auth-password" placeholder="Password" aria-label="Password" />
  <button id="signup-btn">Sign Up</button>
  <button id="login-btn">Log In</button>
  <button id="google-btn">Sign in with Google</button>
  <div id="auth-message" style="margin-top:10px;color:green;"></div>
`;
document.getElementById('home-content').appendChild(authDiv);

const emailInput = document.getElementById('auth-email');
const passInput = document.getElementById('auth-password');
const msgDiv = document.getElementById('auth-message');

// Top buttons open auth UI
document.getElementById('signup-btn-top').addEventListener('click', () => authDiv.style.display='block');
document.getElementById('login-btn-top').addEventListener('click', () => authDiv.style.display='block');

// Sign Up
document.getElementById('signup-btn').addEventListener('click', async () => {
  try {
    const userCredential = await createUserWithEmailAndPassword(auth, emailInput.value, passInput.value);
    await setDoc(doc(db,'users',userCredential.user.uid), {pokemon:[]});
    msgDiv.style.color='green';
    msgDiv.textContent=`Sign up successful! Welcome, ${userCredential.user.email}`;
  } catch(err) { msgDiv.style.color='red'; msgDiv.textContent=err.message; }
});

// Log In
document.getElementById('login-btn').addEventListener('click', async () => {
  try {
    const userCredential = await signInWithEmailAndPassword(auth,emailInput.value,passInput.value);
    msgDiv.style.color='green';
    msgDiv.textContent=`Logged in as ${userCredential.user.email}`;
  } catch(err){ msgDiv.style.color='red'; msgDiv.textContent=err.message; }
});

// Google Sign-In
document.getElementById('google-btn').addEventListener('click', async () => {
  try {
    const provider = new GoogleAuthProvider();
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    const userRef = doc(db,'users',user.uid);
    const docSnap = await getDoc(userRef);
    if(!docSnap.exists()) await setDoc(userRef,{pokemon:[]});
    msgDiv.style.color='green';
    msgDiv.textContent=`Google Sign-in successful! Welcome ${user.displayName || user.email}`;
  } catch(err){ msgDiv.style.color='red'; msgDiv.textContent=err.message; }
});

// Auth state change
onAuthStateChanged(auth, (user) => {
  if(user){ msgDiv.setAttribute('aria-live','polite'); msgDiv.textContent=`Welcome ${user.displayName || user.email}`; }
});
</script>

</body>
</html>