<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Accessible Pokémon — Map + 300 Pokémon</title>
<style>
:root{--nav:#222;--accent:#9be29b;--bg:#f7fbff}
html,body{height:100%;margin:0;font-family:system-ui,Arial,Helvetica,sans-serif;background:var(--bg);color:#111;display:flex;flex-direction:column;}
main{flex:1;overflow:auto;padding:12px 12px 92px;}
nav{display:flex;gap:0;position:fixed;bottom:0;left:0;right:0;background:var(--nav);color:#fff;z-index:10}
nav button{flex:1;padding:12px 8px;border:0;background:transparent;color:#fff;font-size:15px;cursor:pointer}
nav button.active{background:#111;outline:3px solid #ff0}
h1{margin:8px 0 6px}
.panel{background:#fff;border:1px solid #e3e7ef;border-radius:10px;padding:10px}
.flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{padding:9px 12px;border:0;border-radius:9px;background:#1976d2;color:#fff;cursor:pointer}
.btn.alt{background:var(--accent);color:#000}
.btn.ghost{background:transparent;border:1px solid #cfd6e4;color:#000}
select,input,button{font-size:15px}
label{display:block;margin:6px 0 2px}
small,.sub{color:#555}
.kv{display:flex;justify-content:space-between;border-bottom:1px dashed #eee;padding:6px 0}
.grid{display:grid;gap:8px}
@media(min-width:720px){ main{padding:18px 18px 116px} nav button{font-size:16px} }
</style>
</head>
<body>
<main>
  <!-- HOME -->
  <section id="home" class="tab" role="tabpanel">
    <h1>Home</h1>
    <div id="player-info" class="panel" aria-live="polite"></div>
    <div class="flex">
      <button id="open-pokedex" class="btn alt">Open Pokedex</button>
      <button id="save-manual" class="btn ghost">Save Now</button>
      <button id="reset-game" class="btn ghost">Reset Save</button>
    </div>
    <div class="panel">
      <h2>Bank</h2>
      <div class="flex">
        <label for="bank-deposit">Deposit</label>
        <select id="bank-deposit"><option value="">Choose</option><option value="10">$10</option><option value="20">$20</option><option value="50">$50</option><option value="all">All</option></select>
        <label for="bank-withdraw">Withdraw</label>
        <select id="bank-withdraw"><option value="">Choose</option><option value="10">$10</option><option value="20">$20</option><option value="50">$50</option><option value="all">All</option></select>
      </div>
    </div>
    <div class="panel" id="party-panel">
      <h2>Party (max 6)</h2>
      <div id="party-list" class="grid"></div>
      <h3>Box</h3>
      <div id="box-list" class="grid"></div>
    </div>
    <h2>Pokedex</h2>
    <div id="pokedex-list" class="panel" style="display:none"></div>
  </section>

  <!-- MAP -->
  <section id="map" class="tab" role="tabpanel">
    <h1>Map</h1>
    <div class="panel">
      <p class="sub">Travel to different locations. Explore and Gather will be affected by your current location.</p>
      <div id="locations-list" class="grid"></div>
      <p id="map-log" aria-live="polite"></p>
    </div>
  </section>

  <!-- INVENTORY -->
  <section id="inventory" class="tab" role="tabpanel">
    <h1>Inventory</h1>
    <div id="inventory-list" class="panel" aria-live="polite"></div>
  </section>

  <!-- EXPLORE -->
  <section id="explore" class="tab" role="tabpanel">
    <h1>Explore</h1>
    <div class="panel">
      <p class="sub">Find wild Pokémon. Encounter chances depend on current location.</p>
      <button id="catch-pokemon" class="btn alt">Search & Catch</button>
      <p id="explore-log" aria-live="polite"></p>
    </div>
  </section>

  <!-- GATHER -->
  <section id="gather" class="tab" role="tabpanel">
    <h1>Gather</h1>
    <div class="panel">
      <p class="sub">Gather resources from your current location.</p>
      <button id="gather-resource" class="btn alt">Gather Resource (+10 XP)</button>
      <p id="gather-log" aria-live="polite"></p>
    </div>
  </section>

  <!-- BATTLE -->
  <section id="battle" class="tab" role="tabpanel">
    <h1>Battle</h1>
    <div class="flex">
      <button id="start-battle" class="btn alt">Start Wild Battle</button>
      <button id="challenge-gym" class="btn">Challenge Gym</button>
    </div>
    <div id="battle-area" style="margin-top:12px;display:none;">
      <div class="panel" id="battle-stats" aria-live="polite"></div>
      <div id="move-buttons" class="flex" style="margin-top:10px;"></div>
    </div>
    <p id="battle-log" aria-live="assertive" style="white-space:pre-wrap;margin-top:10px;"></p>
  </section>

  <!-- TRADE -->
  <section id="trade" class="tab" role="tabpanel">
    <h1>Trade</h1>
    <div class="flex">
      <button id="sell-all-top" class="btn alt">Sell All Sellable Items</button>
    </div>
    <label for="trade-mode">Choose Mode</label>
    <select id="trade-mode"><option value="buy">Buy Items</option><option value="sell">Sell Items</option></select>
    <div id="trade-panel" class="panel" style="margin-top:10px"></div>
  </section>
</main>

<nav>
  <button class="tab-btn active" data-target="home">Home</button>
  <button class="tab-btn" data-target="map">Map</button>
  <button class="tab-btn" data-target="inventory">Inventory</button>
  <button class="tab-btn" data-target="explore">Explore</button>
  <button class="tab-btn" data-target="gather">Gather</button>
  <button class="tab-btn" data-target="battle">Battle</button>
  <button class="tab-btn" data-target="trade">Trade</button>
</nav>

<script>
// ===== UTILS =====
const rng = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const beep=(freq=660,dur=120)=>{try{const ctx=new (window.AudioContext||window.webkitAudioContext)();const o=ctx.createOscillator();const g=ctx.createGain();o.type='sine';o.frequency.value=freq;g.gain.value=0.18;o.connect(g);g.connect(ctx.destination);o.start();setTimeout(()=>{o.stop();ctx.close();},dur);}catch(e){}};

// ===== SAVE / PLAYER =====
const DEFAULT_PLAYER={level:1,xp:0,money:1000,bank:0,inventory:{},gear:{},party:[],box:[],mons:{},badges:0,location:'Forest'};
let player=loadPlayer();

function loadPlayer(){
  const s = localStorage.getItem('pkm_player_v8');
  if(s){try{return JSON.parse(s);}catch(e){}}
  localStorage.setItem('pkm_player_v8', JSON.stringify(DEFAULT_PLAYER));
  return structuredClone(DEFAULT_PLAYER);
}
function savePlayer(){ localStorage.setItem('pkm_player_v8', JSON.stringify(player)); updateUI(); }
function resetPlayer(){ if(confirm('Reset save?')){ player=structuredClone(DEFAULT_PLAYER); savePlayer(); location.reload(); } }
function gainXP(amount){ player.xp+=amount; while(player.xp>=100){player.level++;player.xp-=100;beep(880,140); alert(`Leveled up! Level ${player.level}`);} savePlayer(); }

// ===== POKEDEX (simplified for brevity)