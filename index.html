<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Adventure</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f0f0f0; }
  .tabs { display: flex; border-top: 2px solid #333; background: #fff; position: fixed; bottom: 0; width: 100%; }
  .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; outline: none; }
  .tab.selected { background: #ddd; font-weight: bold; }
  .tab-content { padding: 20px; margin-bottom: 60px; display: none; }
  .tab-content.active { display: block; }
  button { padding: 10px; margin: 5px; font-size: 16px; }
  .pokemon-item { margin-bottom: 5px; }
  #market-items button { display:block; margin:5px 0; }
</style>
</head>
<body>

<!-- Tabs Content -->
<div class="tab-content active" id="home-content">
  <h2>Home</h2>
  <button id="signup-btn-top">Sign Up</button>
  <button id="login-btn-top">Log In</button>
  <p>Welcome to Pokémon Adventure!</p>
</div>

<div class="tab-content" id="pokemon-content">
  <h2>Pokémon</h2>
  <div id="pokemon-list"></div>
</div>

<div class="tab-content" id="gather-content">
  <h2>Gather</h2>
  <button id="gather-btn">Gather Item</button>
  <div id="gather-result"></div>
</div>

<div class="tab-content" id="battle-content">
  <h2>Battle</h2>
  <select id="player-pokemon-select"></select>
  <button id="start-battle-btn">Start Battle</button>
  <div id="battle-log"></div>
</div>

<div class="tab-content" id="market-content">
  <h2>Poké Market</h2>
  <h3>Inventory</h3>
  <div id="inventory-list"></div>
  <h3>Market Items</h3>
  <div id="market-items"></div>
</div>

<!-- Bottom Tabs -->
<div class="tabs" role="tablist">
  <div class="tab selected" role="tab" aria-selected="true" aria-controls="home-content">Home</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="pokemon-content">Pokémon</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="gather-content">Gather</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="battle-content">Battle</div>
  <div class="tab" role="tab" aria-selected="false" aria-controls="market-content">Market</div>
</div>

<!-- Audio -->
<audio id="buy-sound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAAAAA="></audio>
<audio id="sell-sound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAAAAA="></audio>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.25.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.25.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.25.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDB4XhURDerrLIfb_PdcyDHiBhyzIqRxvY",
  authDomain: "pokemon-756e7.firebaseapp.com",
  projectId: "pokemon-756e7",
  storageBucket: "pokemon-756e7.appspot.com",
  messagingSenderId: "799827870179",
  appId: "1:799827870179:web:7cf9995a4c45469b02e0d6"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Tabs Navigation
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => { t.classList.remove('selected'); t.setAttribute('aria-selected','false'); });
    tab.classList.add('selected'); tab.setAttribute('aria-selected','true');
    contents.forEach(c => c.classList.remove('active'));
    document.getElementById(tab.getAttribute('aria-controls')).classList.add('active');
  });
});

// Pokémon Data (first 151)
const pokemonData = [
  {name:"Bulbasaur",type:"Grass/Poison",level:5,hp:45,attack:49,defense:49,speed:45,moves:[{name:"Tackle",power:40},{name:"Vine Whip",power:45},{name:"Growl",power:0},{name:"Leech Seed",power:0}]},
  {name:"Ivysaur",type:"Grass/Poison",level:10,hp:60,attack:62,defense:63,speed:60,moves:[{name:"Tackle",power:40},{name:"Vine Whip",power:45},{name:"Growl",power:0},{name:"Leech Seed",power:0}]},
  {name:"Venusaur",type:"Grass/Poison",level:20,hp:80,attack:82,defense:83,speed:80,moves:[{name:"Tackle",power:40},{name:"Vine Whip",power:45},{name:"Growl",power:0},{name:"Leech Seed",power:0}]},
  {name:"Charmander",type:"Fire",level:5,hp:39,attack:52,defense:43,speed:65,moves:[{name:"Scratch",power:40},{name:"Ember",power:40},{name:"Growl",power:0},{name:"Smokescreen",power:0}]},
  {name:"Charmeleon",type:"Fire",level:10,hp:58,attack:64,defense:58,speed:80,moves:[{name:"Scratch",power:40},{name:"Ember",power:40},{name:"Growl",power:0},{name:"Smokescreen",power:0}]},
  {name:"Charizard",type:"Fire/Flying",level:20,hp:78,attack:84,defense:78,speed:100,moves:[{name:"Scratch",power:40},{name:"Ember",power:40},{name:"Growl",power:0},{name:"Smokescreen",power:0}]}
];

// Display Pokémon
const pokemonListDiv = document.getElementById('pokemon-list');
pokemonData.forEach(p => {
  const div = document.createElement('div');
  div.className = 'pokemon-item';
  div.textContent = `${p.name} - Type: ${p.type} - Level: ${p.level}`;
  pokemonListDiv.appendChild(div);
});

// Player Data
let playerXP = 0;
let inventory = [];

// Gather System
const gatherBtn = document.getElementById('gather-btn');
const gatherResult = document.getElementById('gather-result');
const items = ["Pokéball","Potion","Rare Candy","Berry","Stone"];
gatherBtn.addEventListener('click', () => {
  const item = items[Math.floor(Math.random()*items.length)];
  inventory.push(item);
  playerXP += 10;
  gatherResult.textContent = `You gathered: ${item}! Level 1 +10 XP (Total XP: ${playerXP})`;
  updateInventory();
});

// Inventory display
function updateInventory() {
  const invDiv = document.getElementById('inventory-list');
  invDiv.innerHTML = inventory.map((i,idx)=>`<div>${i} <button onclick="sellItem(${idx})">Sell</button></div>`).join('');
}

// Market
const marketDiv = document.getElementById('market-items');
const marketItems = [{name:"Pokéball",price:50},{name:"Potion",price:100}];
marketItems.forEach(item=>{
  const btn = document.createElement('button');
  btn.textContent = `Buy ${item.name} - ${item.price} coins`;
  btn.addEventListener('click',()=>{
    inventory.push(item.name);
    document.getElementById('buy-sound').play();
    updateInventory();
  });
  marketDiv.appendChild(btn);
});

window.sellItem = function(idx){
  inventory.splice(idx,1);
  document.getElementById('sell-sound').play();
  updateInventory();
};

// Battle System
const playerSelect = document.getElementById('player-pokemon-select');
pokemonData.forEach((p,idx)=>{
  const opt = document.createElement('option');
  opt.value = idx;
  opt.textContent = p.name;
  playerSelect.appendChild(opt);
});
const battleLog = document.getElementById('battle-log');
document.getElementById('start-battle-btn').addEventListener('click',()=>{
  const player = pokemonData[playerSelect.value];
  const enemy = pokemonData[Math.floor(Math.random()*pokemonData.length)];
  let playerHP = player.hp;
  let enemyHP = enemy.hp;
  battleLog.innerHTML = `Battle Start! ${player.name} vs ${enemy.name}<br>`;
  const interval = setInterval(()=>{
    if(playerHP<=0 || enemyHP<=0){ clearInterval(interval); battleLog.innerHTML+=playerHP>0?`<br>You won! +50 XP`:`<br>You lost!`; return;}
    const move = player.moves[Math.floor(Math.random()*player.moves.length)];
    enemyHP-=move.power; if(enemyHP<0)enemyHP=0;
    battleLog.innerHTML+=`${player.name} used ${move.name}! Enemy HP: ${enemyHP}<br>`;
    if(enemyHP<=0) return;
    const emove = enemy.moves[Math.floor(Math.random()*enemy.moves.length)];
    playerHP-=emove.power; if(playerHP<0)playerHP=0;
    battleLog.innerHTML+=`${enemy.name} used ${emove.name}! Your HP: ${playerHP}<br>`;
  },1000);
});

// --- Firebase Auth Modal ---
const modal = document.createElement('div');
modal.id = 'auth-modal';
modal.style.position='fixed'; modal.style.top='0'; modal.style.left='0'; modal.style.width='100%'; modal.style.height='100%';
modal.style.background='rgba(0,0,0,0.8)'; modal.style.display='none'; modal.style.justifyContent='center'; modal.style.alignItems='center'; modal.style.zIndex='10000';
modal.innerHTML=`
  <div style="background:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px;">
    <h2 id="auth-title">Sign Up / Log In</h2>
    <input type="email" id="auth-email" placeholder="Email" style="width:100%;margin:5px 0;padding:8px;">
    <input type="password" id="auth-password" placeholder="Password" style="width:100%;margin:5px 0;padding:8px;">
    <div style="margin-top:10px;">
      <button id="auth-signup">Sign Up</button>
      <button id="auth-login">Log In</button>
      <button id="auth-google">Sign in with Google</button>
    </div>
    <button id="auth-close" style="margin-top:10px;background:#f44336;color:white;width:100%;">Close</button>
    <p id="auth-msg" style="color:red;margin-top:10px;"></p>
  </div>
`;
document.body.appendChild(modal);

const authEmail = document.getElementById('auth-email');
const authPassword = document.getElementById('auth-password');
const authMsg = document.getElementById('auth-msg');
const authClose = document.getElementById('auth-close');
const signupBtn = document.getElementById('auth-signup');
const loginBtn = document.getElementById('auth-login');
const googleBtn = document.getElementById('auth-google');

document.getElementById('signup-btn-top').addEventListener('click',()=>{modal.style.display='flex'; authEmail.focus();});
document.getElementById('login-btn-top').addEventListener('click',()=>{modal.style.display='flex'; authEmail.focus();});
authClose.addEventListener('click',()=>{modal.style.display='none';});

signupBtn.addEventListener('click', async()=>{
  try{
    const userCredential=await createUserWithEmailAndPassword(auth,authEmail.value,authPassword.value);
    await setDoc(doc(db,'users',userCredential.user.uid),{pokemon:[]});
    authMsg.style.color='green'; authMsg.textContent=`Sign up successful! Welcome ${userCredential.user.email}`;
    modal.style.display='none';
  }catch(err){authMsg.style.color='red'; authMsg.textContent=err.message;}
});

loginBtn.addEventListener('click', async()=>{
  try{
    const userCredential=await signInWithEmailAndPassword(auth,authEmail.value,authPassword.value);
    authMsg.style.color='green'; authMsg.textContent=`Logged in as ${userCredential.user.email}`;
    modal.style.display='none';
  }catch(err){authMsg.style.color='red'; authMsg.textContent=err.message;}
});

googleBtn.addEventListener('click', async()=>{
  try{
    const provider=new GoogleAuthProvider();
    const result=await signInWithPopup(auth,provider);
    const user=result.user;
    const userRef=doc(db,'users',user.uid);
    const docSnap=await getDoc(userRef);
    if(!docSnap.exists()) await setDoc(userRef,{pokemon:[]});
    authMsg.style.color='green'; authMsg.textContent=`Google Sign-in successful! Welcome ${user.displayName||user.email}`;
    modal.style.display='none';
  }catch(err){authMsg.style.color='red'; authMsg.textContent=err.message;}
});

onAuthStateChanged(auth,(user)=>{
  if(user){ authMsg.setAttribute('aria-live','polite'); authMsg.textContent=`Welcome ${user.displayName||user.email}`; }
});
</script>

</body>
</html>