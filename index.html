<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Accessible Madden — Text Adventure Prototype</title>
<style>
  :focus { outline: 3px solid #ffcc00; outline-offset: 2px; }
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#0b1220; color:#e6eef6; margin:0; padding:18px; }
  main { max-width:900px; margin:0 auto; }
  header h1 { margin:0 0 8px 0; font-size:1.5rem; }
  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
  .panel { background:#111827; padding:12px; border-radius:8px; box-shadow: 0 4px 10px rgba(0,0,0,0.6); }
  button { background:#1f6feb; color:white; border:0; padding:10px 14px; border-radius:6px; cursor:pointer; }
  button.secondary { background:#374151; }
  button.ghost { background:transparent; border:1px solid #334155; color:#cbd5e1; }
  select { padding:8px; border-radius:6px; background:#0b1228; color:#e6eef6; border:1px solid #334155; }
  .play-list { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .play-item { background:#081126; padding:10px 12px; border-radius:6px; border:1px solid #1f2937; }
  .status { margin-top:12px; }
  .live { padding:12px; background:#041022; border-radius:8px; margin-top:12px; min-height:64px; }
  .visually-hidden { position:absolute !important; clip:rect(1px,1px,1px,1px); clip-path:inset(50%); height:1px; width:1px; overflow:hidden; white-space:nowrap; }
  footer { margin-top:18px; font-size:0.9rem; color:#94a3b8; }
  .stat-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-top:8px; }
  .card { background:#0b1228; padding:10px; border-radius:6px; border:1px solid #1f2937;}
</style>
</head>
<body>
<main>
  <header>
    <h1>Accessible Madden — Text Adventure Prototype</h1>
    <p id="brief" class="panel">Screen-reader optimized. Keyboard: use <kbd>1</kbd>-<kbd>6</kbd> to highlight plays, <kbd>Enter</kbd> to execute, <kbd>R</kbd> repeat last commentary, <kbd>S</kbd> show stats, <kbd>H</kbd> help.</p>
  </header>

  <!-- Live region for screen readers -->
  <div id="sr-live" class="visually-hidden" role="status" aria-live="assertive"></div>

  <!-- Game controls -->
  <section class="panel" aria-labelledby="game-controls-label">
    <h2 id="game-controls-label">Game Controls</h2>

    <div class="row" style="margin-top:8px;">
      <div>
        <label for="modeSelect">Mode</label><br/>
        <select id="modeSelect" aria-label="Game mode">
          <option value="quick">Quick Play</option>
          <option value="franchise">Franchise</option>
        </select>
      </div>

      <div>
        <label for="difficulty">Difficulty</label><br/>
        <select id="difficulty" aria-label="Difficulty level">
          <option>Rookie</option>
          <option>Pro</option>
          <option>All-Pro</option>
          <option>All-Madden</option>
        </select>
      </div>

      <div>
        <label for="quarterLength">Quarter Length (min)</label><br/>
        <select id="quarterLength" aria-label="Quarter length">
          <option>2</option>
          <option selected>5</option>
          <option>10</option>
          <option>15</option>
        </select>
      </div>

      <div>
        <button id="newGameBtn">New Game (Start)</button>
      </div>
    </div>

    <div class="status" aria-hidden="false" id="statusSummary" style="margin-top:12px;">
      <div class="stat-grid">
        <div class="card"><strong id="teamHome">Home: 49ers</strong></div>
        <div class="card"><strong id="teamAway">Away: —</strong></div>
        <div class="card">Quarter: <span id="quarter">0</span></div>
        <div class="card">Time Left: <span id="timeleft">00:00</span></div>
      </div>
    </div>
  </section>

  <!-- Play area -->
  <section class="panel" aria-labelledby="playbook-label" id="playArea" style="margin-top:12px; display:none;">
    <h2 id="playbook-label">Playbook & Drive</h2>

    <div>
      <p id="driveInfo">No game in progress.</p>
      <div class="play-list" role="list" aria-label="Playbook">
        <!-- play items inserted here -->
      </div>
      <div style="margin-top:10px;">
        <button id="selectBtn" class="secondary">Select Play</button>
        <button id="executeBtn">Execute Play</button>
        <button id="endDriveBtn" class="ghost">End Drive</button>
        <button id="statsBtn" class="ghost">Show Stats</button>
      </div>
    </div>

    <div class="live panel" id="commentaryLive" aria-live="polite" role="log">Commentary will appear here.</div>
  </section>

  <!-- Halftime & Postgame panels -->
  <section id="halftimePanel" class="panel" style="display:none; margin-top:12px;">
    <h2>Halftime Show</h2>
    <div id="halftimeContent">Halftime summary will appear here.</div>
    <div style="margin-top:8px;">
      <button id="endHalftimeBtn">End Halftime</button>
    </div>
  </section>

  <section id="postgamePanel" class="panel" style="display:none; margin-top:12px;">
    <h2>Postgame Show</h2>
    <div id="postgameContent">Postgame summary will appear here.</div>
    <div style="margin-top:8px;">
      <button id="newGameAfterBtn">Start New Game</button>
    </div>
  </section>

  <footer>
    <p>Accessible prototype — everything stays in this chat / this file until you share it.</p>
  </footer>
</main>

<script>
/* ============================
   Accessible Madden — Prototype
   ============================
   - Quick-play text adventure with 4 quarters, halftime, postgame show
   - Screen reader friendly via aria-live regions and visible focus
   - Keyboard shortcuts: 1-6 to choose plays, Enter to execute, R repeat, S stats, H help
*/

/* --- Config / state --- */
const HOME_TEAM = "San Francisco 49ers";
const ALL_TEAMS = [
  "San Francisco 49ers","Arizona Cardinals","Atlanta Falcons","Baltimore Ravens",
  "Buffalo Bills","Carolina Panthers","Chicago Bears","Cincinnati Bengals",
  "Cleveland Browns","Dallas Cowboys","Denver Broncos","Detroit Lions",
  "Green Bay Packers","Houston Texans","Indianapolis Colts","Jacksonville Jaguars",
  "Kansas City Chiefs","Las Vegas Raiders","Los Angeles Chargers","Los Angeles Rams",
  "Miami Dolphins","Minnesota Vikings","New England Patriots","New Orleans Saints",
  "New York Giants","New York Jets","Philadelphia Eagles","Pittsburgh Steelers",
  "Seattle Seahawks","Tampa Bay Buccaneers","Tennessee Titans","Washington Commanders"
];

const PLAYBOOK = [
  { id:1, name:"Inside Zone", type:"run", desc:"Hand off inside gap." },
  { id:2, name:"Outside Toss", type:"run", desc:"Pitch outside to the running back." },
  { id:3, name:"Draw", type:"run", desc:"Delayed handoff after pass look." },
  { id:4, name:"Quick Slant", type:"pass", desc:"Short slant route across the middle." },
  { id:5, name:"Deep Post", type:"pass", desc:"Quarterback looks deep to the post." },
  { id:6, name:"Play Action", type:"pass", desc:"Fake run then pass downfield." }
];

let state = {
  home: HOME_TEAM,
  away: null,
  quarter: 0,
  quarterLengthMin: 5,
  timeLeftSec: 0,   // seconds remaining in current quarter
  ballYardline: 25, // 1..99 where 100=opponent endzone? We'll treat 0-100 with 25 start
  down: 1,
  togo: 10,
  possession: 'home', // 'home' or 'away'
  score: { home:0, away:0 },
  driveSeq: [], // logs plays this drive
  lastComment: '',
  gameRunning: false,
  halftimeShown: false,
  gameOver: false,
  selectedPlayIdx: 0
};

/* --- DOM references --- */
const srLive = document.getElementById('sr-live');
const playArea = document.getElementById('playArea');
const driveInfo = document.getElementById('driveInfo');
const commentaryLive = document.getElementById('commentaryLive');
const playListDiv = document.querySelector('.play-list');

const quarterEl = document.getElementById('quarter');
const timeLeftEl = document.getElementById('timeleft');
const teamHomeEl = document.getElementById('teamHome');
const teamAwayEl = document.getElementById('teamAway');

const newGameBtn = document.getElementById('newGameBtn');
const selectBtn = document.getElementById('selectBtn');
const executeBtn = document.getElementById('executeBtn');
const endDriveBtn = document.getElementById('endDriveBtn');
const statsBtn = document.getElementById('statsBtn');
const statsPanelBtn = document.getElementById('statsBtn');

const halftimePanel = document.getElementById('halftimePanel');
const halftimeContent = document.getElementById('halftimeContent');
const endHalftimeBtn = document.getElementById('endHalftimeBtn');

const postgamePanel = document.getElementById('postgamePanel');
const postgameContent = document.getElementById('postgameContent');
const newGameAfterBtn = document.getElementById('newGameAfterBtn');

/* --- helpers: announcements (ARIA + SpeechSynthesis) --- */
function announce(text, polite=false){
  // ARIA live region (always available for screen readers)
  srLive.textContent = text;
  // Also add to commentary area for visual users
  commentaryLive.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> — ${escapeHtml(text)}`;
  state.lastComment = text;
  // Optional: speech synthesis for additional audio (user/browser dependent)
  try {
    if(window.speechSynthesis && !polite){
      const msg = new SpeechSynthesisUtterance(text);
      // keep short, avoid long chattiness
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(msg);
    }
  } catch(e){ /* ignore speech failures */ }
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;'); }

/* --- UI build: playbook items --- */
function buildPlaybook(){
  playListDiv.innerHTML = '';
  PLAYBOOK.forEach((p, idx) => {
    const btn = document.createElement('button');
    btn.className = 'play-item';
    btn.setAttribute('role','listitem');
    btn.setAttribute('data-idx', idx);
    btn.tabIndex = 0;
    btn.innerHTML = `${p.id}. ${p.name} <div style="font-size:0.9rem;color:#94a3b8">${p.desc}</div>`;
    btn.addEventListener('click', () => {
      setSelectedPlay(idx);
    });
    playListDiv.appendChild(btn);
  });
  setSelectedPlay(0);
}

/* highlight + announce play */
function setSelectedPlay(idx){
  const items = playListDiv.querySelectorAll('.play-item');
  items.forEach((it,i)=> {
    it.style.boxShadow = i===idx ? '0 0 0 3px rgba(99,102,241,0.25)' : 'none';
    it.style.border = i===idx ? '1px solid #6366f1' : '1px solid #1f2937';
  });
  state.selectedPlayIdx = idx;
  const p = PLAYBOOK[idx];
  announce(`Highlighted: ${p.name}. ${p.desc}`);
  // focus the selected element for keyboard users
  items[idx].focus();
}

/* --- Game flow helpers --- */
function resetGameDefaults(){
  state.quarterLengthMin = parseInt(document.getElementById('quarterLength').value,10) || 5;
  state.quarter = 1;
  state.timeLeftSec = state.quarterLengthMin * 60;
  state.ballYardline = 25;
  state.down = 1;
  state.togo = 10;
  state.possession = 'home';
  state.score = { home:0, away:0 };
  state.driveSeq = [];
  state.lastComment = '';
  state.gameRunning = true;
  state.halftimeShown = false;
  state.gameOver = false;
  state.selectedPlayIdx = 0;
  // choose away team randomly
  const others = ALL_TEAMS.filter(t => t !== state.home);
  state.away = others[Math.floor(Math.random()*others.length)];
  teamHomeEl.textContent = `Home: ${state.home} (${state.score.home})`;
  teamAwayEl.textContent = `Away: ${state.away} (${state.score.away})`;
  quarterEl.textContent = state.quarter;
  updateTimeUI();
  buildPlaybook();
  playArea.style.display = 'block';
  halftimePanel.style.display = 'none';
  postgamePanel.style.display = 'none';
  announce(`Kickoff! ${state.home} vs ${state.away}. ${state.home} will receive the opening kickoff. First and ten at the 25.`);
}

/* update time UI formatted */
function updateTimeUI(){
  const mm = Math.floor(state.timeLeftSec/60).toString().padStart(2,'0');
  const ss = (state.timeLeftSec%60).toString().padStart(2,'0');
  timeLeftEl.textContent = `${mm}:${ss}`;
  quarterEl.textContent = state.quarter;
  teamHomeEl.textContent = `Home: ${state.home} (${state.score.home})`;
  teamAwayEl.textContent = `Away: ${state.away} (${state.score.away})`;
  driveInfo.textContent = `${state.possession === 'home' ? state.home : state.away} ball — Down ${state.down} and ${state.togo}, ball at the ${state.ballYardline} yard line.`;
}

/* short helper to advance clock by approximate amount (drives shrink time) */
function advanceClockBySeconds(sec){
  state.timeLeftSec = Math.max(0, state.timeLeftSec - sec);
  updateTimeUI();
  if(state.timeLeftSec <= 0){
    endQuarter();
  }
}

/* Quarter and halftime handling */
function endQuarter(){
  if(state.quarter === 2 && !state.halftimeShown){
    // show halftime
    state.halftimeShown = true;
    showHalftime();
    return;
  }
  if(state.quarter >= 4){
    finishGame();
    return;
  }
  // advance quarter
  state.quarter += 1;
  state.timeLeftSec = state.quarterLengthMin * 60;
  announce(`Quarter ${state.quarter} begins. ${state.possession === 'home' ? state.home : state.away} has the ball.`);
  updateTimeUI();
}

/* halftime display */
function showHalftime(){
  playArea.style.display = 'none';
  halftimePanel.style.display = 'block';
  const summary = `${state.home} ${state.score.home}, ${state.away} ${state.score.away}. Halftime stats placeholder.`;
  halftimeContent.textContent = summary;
  announce(`Halftime. ${summary}`);
}

/* end halftime */
endHalftimeBtn.addEventListener('click', () => {
  halftimePanel.style.display = 'none';
  // start 3rd quarter
  state.quarter = 3;
  state.timeLeftSec = state.quarterLengthMin*60;
  playArea.style.display = 'block';
  announce(`Second half begins. Quarter ${state.quarter}. ${state.possession === 'home' ? state.home : state.away} will receive.`);
  updateTimeUI();
});

/* finish game */
function finishGame(){
  state.gameRunning = false;
  state.gameOver = true;
  playArea.style.display = 'none';
  postgamePanel.style.display = 'block';
  const summary = `Final score: ${state.home} ${state.score.home}, ${state.away} ${state.score.away}.`;
  postgameContent.textContent = summary + " Postgame highlights: placeholder highlights.";
  announce(`Game over. ${summary} Postgame show now available.`);
}

/* new game after postgame */
newGameAfterBtn.addEventListener('click', () => {
  postgamePanel.style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
  announce('Returned to main menu.');
});

/* --- Play execution simulation --- */
function simulatePlay(playObj){
  // basic deterministic-ish randomness influenced by difficulty
  const diff = document.getElementById('difficulty').value;
  const difficultyModifier = diff === 'Rookie' ? 0.15 : diff === 'Pro' ? 0 : diff === 'All-Pro' ? -0.05 : -0.12;
  const rand = Math.random() + difficultyModifier; // higher is better for offense (if home has ball)
  let yards = 0, text='';
  if(playObj.type === 'run'){
    // runs: mostly short gains
    yards = Math.floor( (rand > 0.6 ? 6 : (rand > 0.3 ? 3 : -1)) + (Math.random()*3) );
    if(yards < 0) text = `Tackle for loss of ${Math.abs(yards)} yards.`;
    else text = `Run for ${yards} yards.`;
  } else {
    // pass
    if(rand > 0.55){
      yards = Math.floor(5 + Math.random()*15);
      text = `Complete for ${yards} yards.`;
    } else if(rand > 0.3){
      yards = 0;
      text = `Incomplete pass.`;
    } else {
      // turnover chance
      const pick = Math.random() < 0.08;
      if(pick){
        text = `Interception! Turnover.`;
        yards = 0;
        // flip possession
        togglePossession(true);
      } else {
        text = `Sack or pressure; no gain.`;
        yards = -2;
      }
    }
  }

  // Apply yards if not turnover that flipped
  if(!text.toLowerCase().includes('interception')){
    // advance ball
    state.ballYardline = Math.min(100, state.ballYardline + yards); // moving towards opponent end zone
  }

  // update down / togo
  if(yards >= state.togo){
    // first down
    state.down = 1;
    state.togo = 10;
  } else {
    state.down = Math.min(4, state.down + 1);
    state.togo = Math.max(1, state.togo - Math.max(0,yards));
  }

  // Check touchdown
  if(state.ballYardline >= 100){
    // touchdown for possession team
    const scorer = state.possession;
    state.score[scorer === 'home' ? 'home' : 'away'] += 7;
    announce(`${playObj.name}. ${text} Touchdown ${scorer === 'home' ? state.home : state.away}! Score update: ${state.home} ${state.score.home}, ${state.away} ${state.score.away}.`);
    // reset after kickoff — start opponent possession at 25
    state.ballYardline = 25;
    togglePossession(true); // possession flips on kickoff
    // small clock advance
    advanceClockBySeconds(45 + Math.floor(Math.random()*20));
    return;
  }

  // If turnover earlier toggled possession, we already toggled; else continue
  if(!text.toLowerCase().includes('interception')){
    announce(`${playObj.name}. ${text} Down ${state.down} and ${state.togo} at the ${state.ballYardline}.`);
  } else {
    // if interception, we already announced togglePossession
    announce(text + ` ${state.possession === 'home' ? state.home : state.away} takes over at the ${state.ballYardline}.`);
  }

  // if 4th down and failed, simulate punt (simple)
  if(state.down > 4){
    // automatic punt -> opponent gets ball at 25 (simplified)
    announce(`Turnover on downs. ${state.possession === 'home' ? state.away : state.home} takes over at the 25.`);
    togglePossession(true);
  }

  // Short clock advance per play
  advanceClockBySeconds(20 + Math.floor(Math.random()*25));
}

/* toggle possession: if kickoff or turnover, pass true to reset ball to 25 */
function togglePossession(resetTo25=false){
  state.possession = (state.possession === 'home') ? 'away' : 'home';
  if(resetTo25) state.ballYardline = 25;
  // reset down/togo
  state.down = 1;
  state.togo = 10;
  announce(`${state.possession === 'home' ? state.home : state.away} now has possession. First and ten at the ${state.ballYardline}.`);
  updateTimeUI();
}

/* --- UI action bindings --- */
newGameBtn.addEventListener('click', () => {
  // hide UI parts and start new game
  document.getElementById('mainMenu').style.display='none';
  resetGameDefaults();
});

selectBtn.addEventListener('click', () => {
  setSelectedPlay(state.selectedPlayIdx);
  announce(`Selected ${PLAYBOOK[state.selectedPlayIdx].name}. Press Execute Play to run it.`);
});

executeBtn.addEventListener('click', () => {
  // Ensure a direct gesture executes the play
  const p = PLAYBOOK[state.selectedPlayIdx];
  announce(`Executing ${p.name}.`);
  simulatePlay(p);
});

endDriveBtn.addEventListener('click', () => {
  announce('Drive ended. Returning to main menu.');
  playArea.style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
});

statsBtn.addEventListener('click', () => {
  const s = `Score: ${state.home} ${state.score.home}, ${state.away} ${state.score.away}. Quarter ${state.quarter}. Time ${timeLeftEl.textContent}.`;
  announce(s);
});

/* help / keyboard interactions */
document.addEventListener('keydown', (ev) => {
  if(!state.gameRunning) return;
  const k = ev.key;
  if(k >= '1' && k <= '6'){
    const idx = parseInt(k,10)-1;
    if(idx >=0 && idx < PLAYBOOK.length){
      setSelectedPlay(idx);
    }
  } else if(k === 'Enter'){
    // execute
    executeBtn.focus();
    executeBtn.click();
  } else if(k.toLowerCase() === 'r'){
    // repeat last commentary
    announce(state.lastComment || 'No last commentary.');
  } else if(k.toLowerCase() === 's'){
    statsBtn.click();
  } else if(k.toLowerCase() === 'h'){
    announce("Commands: 1-6 choose plays, Enter execute, R repeat last commentary, S show stats, H help.");
  }
});

/* utility: initialize UI */
(function init(){
  // populate UI team
  document.getElementById('teamHome').textContent = `Home: ${state.home} (0)`;
  // New game remains visible
  document.getElementById('mainMenu').style.display = 'block';
  // build playbook (hidden until game start)
  buildPlaybook();
  announce("Prototype ready. Choose New Game to start.");
})();
</script>
</body>
</html>