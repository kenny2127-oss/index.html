<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pok√©mon Adventure</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3b4cca">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
body{font-family:sans-serif;margin:0;background:#1a202c;color:#e6eef8;padding-bottom:60px;}
header{padding:10px;text-align:center;}
footer{position:fixed;bottom:0;left:0;width:100%;display:flex;background:#3b4cca;z-index:1000;}
footer button{flex:1;background:white;border:none;padding:12px 0;cursor:pointer;}
footer button[aria-selected="true"]{background:#ffcb05;font-weight:bold;}
section{display:none;padding:20px;}
section.active{display:block;}
#installBtn,#dailyRewardBtn,#catchHomeBtn,#catchExploreBtn,#exportBtn,#importBtn,#startBattleBtn,#transferButton{margin:10px;padding:10px;border:none;border-radius:8px;background:#ffcb05;cursor:pointer;}
#liveRegion{position:absolute;left:-9999px;}
#pokedex,.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:10px;margin-top:10px;}
.card{background:#2d3748;border-radius:10px;padding:8px;text-align:center;}
button:disabled{opacity:0.5;cursor:not-allowed;}
textarea,input,select{width:100%;margin:4px 0;padding:6px;border-radius:6px;border:none;}
#battleArea{background:#2d3748;padding:10px;border-radius:10px;margin-top:10px;}
#battleLog{max-height:200px;overflow-y:auto;border:1px solid #fff;padding:6px;margin-top:10px;border-radius:6px;background:#1a202c;}
</style>
</head>
<body>
<header>
<h1>Pok√©mon Adventure</h1>
<button id="installBtn" onclick="installApp()" disabled>üì≤ Install App</button>
<div id="liveRegion" aria-live="polite"></div>
</header>

<main>
<section id="home" class="active">
<h2>Pok√©dex</h2>
<div id="pokedex"></div>
<button id="transferButton">Transfer Pok√©dex from another app</button>
<button id="catchHomeBtn">Catch Pok√©mon</button>
<button id="dailyRewardBtn">Daily Reward</button>
</section>

<section id="explore">
<h2>Explore</h2>
<p>Click below to find a new Pok√©mon!</p>
<button id="catchExploreBtn">Catch Pok√©mon</button>
</section>

<section id="battle">
<h2>Battle</h2>
<div id="battleArea"></div>
<div id="battleLog" aria-live="polite"></div>
</section>

<section id="trade">
<h2>Trade</h2>
<p>Offer a Pok√©mon to generate a short code:</p>
<textarea id="exportData" readonly></textarea>
<button id="exportBtn">Generate Trade Code</button>
<p>Enter a code to receive a Pok√©mon:</p>
<textarea id="importData"></textarea>
<button id="importBtn">Redeem Code</button>
</section>
</main>

<footer role="tablist">
<button role="tab" class="tab-button" data-tab="home" aria-selected="true" onclick="switchTab('home')">Home</button>
<button role="tab" class="tab-button" data-tab="explore" aria-selected="false" onclick="switchTab('explore')">Explore</button>
<button role="tab" class="tab-button" data-tab="battle" aria-selected="false" onclick="switchTab('battle')">Battle</button>
<button role="tab" class="tab-button" data-tab="trade" aria-selected="false" onclick="switchTab('trade')">Trade</button>
</footer>

<script>
let deferredPrompt;
if("serviceWorker" in navigator){navigator.serviceWorker.register("service-worker.js");}
window.addEventListener("beforeinstallprompt",(e)=>{
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById("installBtn").disabled=false;
});
function installApp(){
    if(deferredPrompt){deferredPrompt.prompt();deferredPrompt.userChoice.finally(()=>deferredPrompt=null);}
    else{alert("iOS: Tap the Share button ‚Üí 'Add to Home Screen'.\nAndroid: Open this page via HTTPS; install should appear.");}
}
function switchTab(tabId){
    document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    document.querySelectorAll(".tab-button").forEach(btn=>btn.setAttribute("aria-selected","false"));
    document.querySelector(`[data-tab='${tabId}']`).setAttribute("aria-selected","true");
    announce(tabId.charAt(0).toUpperCase()+tabId.slice(1)+" tab selected");
    if(tabId==="battle"){if(!battleState.player || battleState.playerHP<=0 || battleState.opponentHP<=0){startBattle();}}
}
window.onload=()=>{switchTab("home");loadGame();renderTabs();};

// Pok√©mon list (340)
let pokemonList=[
"Bulbasaur","Ivysaur","Venusaur","Charmander","Charmeleon","Charizard","Squirtle","Wartortle","Blastoise","Caterpie",
"Metapod","Butterfree","Weedle","Kakuna","Beedrill","Pidgey","Pidgeotto","Pidgeot","Rattata","Raticate",
"Spearow","Fearow","Ekans","Arbok","Pikachu","Raichu","Sandshrew","Sandslash","Nidoran‚ôÄ","Nidorina",
"Nidoqueen","Nidoran‚ôÇ","Nidorino","Nidoking","Clefairy","Clefable","Vulpix","Ninetales","Jigglypuff","Wigglytuff",
"Zubat","Golbat","Oddish","Gloom","Vileplume","Paras","Parasect","Venonat","Venomoth","Diglett",
"Dugtrio","Meowth","Persian","Psyduck","Golduck","Mankey","Primeape","Growlithe","Arcanine","Poliwag",
"Poliwhirl","Poliwrath","Abra","Kadabra","Alakazam","Machop","Machoke","Machamp","Bellsprout","Weepinbell"
];

let pokedex=[],items={Potion:0,"Pok√© Ball":0,"Rare Candy":0},achievements={},battleState={player:null,opponent:null,playerHP:0,opponentHP:0,turn:"player"};
function saveGame(){localStorage.setItem("pokedex",JSON.stringify(pokedex));localStorage.setItem("items",JSON.stringify(items));localStorage.setItem("achievements",JSON.stringify(achievements));}
function loadGame(){pokedex=JSON.parse(localStorage.getItem("pokedex"))||[];items=JSON.parse(localStorage.getItem("items"))||{Potion:0,"Pok√© Ball":0,"Rare Candy":0};achievements=JSON.parse(localStorage.getItem("achievements"))||{};renderPokedex();updateAchievements();}
function speak(text){if("speechSynthesis" in window){let u=new SpeechSynthesisUtterance(text);speechSynthesis.speak(u);}}
function announce(text){document.getElementById("liveRegion").innerText=text;}
function renderPokedex(){let c=document.getElementById("pokedex");c.innerHTML="";pokemonList.forEach(p=>{let d=document.createElement("div");d.className="card";d.textContent=pokedex.includes(p)?p:"???";c.appendChild(d);});}
function catchPokemon(){let f=pokemonList[Math.floor(Math.random()*pokemonList.length)];if(!pokedex.includes(f)) pokedex.push(f);saveGame();renderPokedex();speak("You found "+f);announce("You found "+f);updateAchievements();}
function updateAchievements(){let c=pokedex.length,newA=[];if(c>=5&&!achievements.Novice){achievements.Novice=true;newA.push("Novice Collector");}if(c>=10&&!achievements.Collector){achievements.Collector=true;newA.push("Collector");}if(c>=20&&!achievements.Expert){achievements.Expert=true;newA.push("Expert Collector");}saveGame();if(newA.length>0){newA.forEach(a=>speak("Achievement unlocked: "+a));announce("Achievements unlocked: "+newA.join(", "));}}
function dailyReward(){let last=localStorage.getItem("lastDaily"),today=new Date().toDateString();if(last===today){alert("Daily reward claimed!");return;}let r=pokemonList[Math.floor(Math.random()*pokemonList.length)];if(!pokedex.includes(r)) pokedex.push(r);items.Potion++;localStorage.setItem("lastDaily",today);saveGame();renderPokedex();speak("Daily reward: "+r+" and 1 Potion!");announce("Daily reward: "+r+" and 1 Potion!");updateAchievements();}
function exportPokedex(){document.getElementById("exportData").value=JSON.stringify(pokedex);announce("Pok√©dex exported.");}
function importPokedex(){let data=document.getElementById("importData").value;try{let imp=JSON.parse(data),added=0;imp.forEach(p=>{if(!pokedex.includes(p)){pokedex.push(p);added++;}});saveGame();renderPokedex();announce("Pok√©dex updated. "+added+" new Pok√©mon added.");speak(added+" new Pok√©mon added.");updateAchievements();}catch(e){alert("Invalid data!");}}
function renderTabs(){document.getElementById("catchHomeBtn").onclick=catchPokemon;document.getElementById("catchExploreBtn").onclick=catchPokemon;document.getElementById("dailyRewardBtn").onclick=dailyReward;document.getElementById("exportBtn").onclick=exportPokedex;document.getElementById("importBtn").onclick=importPokedex;}

// Battle functions
function startBattle(){if(pokedex.length===0){alert("No Pok√©mon to battle!");return;}renderBattleSelection();}
function renderBattleSelection(){let a=document.getElementById("battleArea");a.innerHTML="<h3>Select your Pok√©mon:</h3>";let s=document.createElement("select");s.id="battleSelect";pokedex.forEach(p=>{let o=document.createElement("option");o.value=p;o.textContent=p;s.appendChild(o);});a.appendChild(s);let b=document.createElement("button");b.textContent="Start Battle";b.onclick=beginBattle;a.appendChild(b);document.getElementById("battleLog").innerHTML="";announce("Select your Pok√©mon to begin battle.");}
function beginBattle(){let p=document.getElementById("battleSelect").value;battleState.player=p;battleState.opponent=pokemonList[Math.floor(Math.random()*pokemonList.length)];battleState.playerHP=100;battleState.opponentHP=100;battleState.turn="player";document.getElementById("battleLog").innerHTML="";announce("Battle started! You chose "+battleState.player+". Opponent is "+battleState.opponent+".");document.getElementById("battleArea").innerHTML="<button onclick='playerAttack()'>Attack</button>";}
function playerAttack(){let dmg=Math.floor(Math.random()*16)+10;battleState.opponentHP-=dmg;if(battleState.opponentHP<0) battleState.opponentHP=0;updateBattleLog(`${battleState.player} hits ${battleState.opponent} for ${dmg}. Opponent HP: ${battleState.opponentHP}`);announce(`${battleState.player} hits ${battleState.opponent} for ${dmg}.`);checkBattleEnd();if(battleState.opponentHP>0)setTimeout(opponentAttack,1000);}
function opponentAttack(){let dmg=Math.floor(Math.random()*11)+10;battleState.playerHP-=dmg;if(battleState.playerHP<0) battleState.playerHP=0;updateBattleLog(`${battleState.opponent} hits ${battleState.player} for ${dmg}. Your HP: ${battleState.playerHP}`);announce(`${battleState.opponent} hits ${battleState.player} for ${dmg}.`);checkBattleEnd();}
function checkBattleEnd(){if(battleState.playerHP<=0){updateBattleLog("You lost!");announce("You lost!");document.getElementById("battleArea").innerHTML='<button onclick="switchTab(\'home\')">Return</button>';}else if(battleState.opponentHP<=0){updateBattle