<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App & Game Generator</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* bg-gray-900 */
            color: #e2e8f0; /* text-gray-200 */
        }
        .container {
            max-width: 640px;
            margin: auto;
            padding: 1rem;
        }
        /* Custom styling for the iframe to ensure it fills the container */
        #generated-content-container {
            width: 100%;
            height: 60vh;
            display: flex;
            flex-direction: column;
            border-radius: 0.75rem;
            overflow: hidden;
        }
        #content-iframe {
            flex-grow: 1;
            width: 100%;
            border: none;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-start py-8 px-4">

    <div class="container bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
        <h1 class="text-3xl font-bold text-center text-indigo-400 mb-4">Content Generator</h1>
        <p class="text-center text-sm mb-6 text-gray-400">
            Enter a prompt to create an app or a game.
        </p>

        <div class="mb-4">
            <textarea
                id="prompt-input"
                class="w-full h-24 p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none text-sm placeholder-gray-400"
                placeholder="e.g., A simple platformer where a square jumps over triangles. An app that lists my favorite movies."
            ></textarea>
        </div>

        <button
            id="submit-prompt-btn"
            class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition duration-200"
        >
            Submit Prompt
        </button>

        <div id="action-menu" class="hidden mt-4 grid grid-cols-2 gap-4">
            <button
                id="create-game-btn"
                class="py-3 px-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition duration-200"
            >
                Create a Game
            </button>
            <button
                id="create-app-btn"
                class="py-3 px-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg transition duration-200"
            >
                Create an App
            </button>
        </div>
        
        <div id="status-message" class="mt-4 p-3 text-sm rounded-lg text-center hidden"></div>
    </div>

    <div id="generated-content-container" class="hidden bg-gray-800 border border-gray-700">
        <h2 class="text-xl font-bold text-center p-4 bg-gray-700 border-b border-gray-600 text-indigo-400">Your Content</h2>
        <iframe id="content-iframe" title="Generated Content" sandbox="allow-scripts"></iframe>
    </div>

    <script>
        // DOM elements
        const promptInput = document.getElementById('prompt-input');
        const submitPromptBtn = document.getElementById('submit-prompt-btn');
        const actionMenu = document.getElementById('action-menu');
        const createGameBtn = document.getElementById('create-game-btn');
        const createAppBtn = document.getElementById('create-app-btn');
        const statusMessage = document.getElementById('status-message');
        const contentContainer = document.getElementById('generated-content-container');
        const contentIframe = document.getElementById('content-iframe');

        // State variables
        let currentPrompt = '';
        let saveTimer = null;

        /**
         * Initializes the app by checking for a saved game in local storage.
         */
        window.onload = function() {
            const savedContent = localStorage.getItem('savedGame');
            if (savedContent) {
                renderContent(savedContent);
                showStatusMessage("Loaded your last saved game from your browser.", 'bg-blue-800 text-blue-200');
            }
        };

        /**
         * Displays a status or error message.
         * @param {string} message The message to display.
         * @param {string} className The Tailwind CSS class for styling.
         */
        const showStatusMessage = (message, className) => {
            statusMessage.textContent = message;
            statusMessage.className = `mt-4 p-3 text-sm rounded-lg text-center ${className}`;
            statusMessage.classList.remove('hidden');
        };

        /**
         * Renders the generated code in the iframe and shows the container.
         * @param {string} html The HTML code for the content.
         */
        const renderContent = (html) => {
            contentIframe.srcdoc = html;
            contentContainer.classList.remove('hidden');
        };

        /**
         * Saves the current game code to local storage.
         */
        const saveGame = () => {
            const gameCode = contentIframe.srcdoc;
            if (gameCode) {
                localStorage.setItem('savedGame', gameCode);
                showStatusMessage("Game automatically saved to your browser!", 'bg-green-800 text-green-200');
            }
        };

        /**
         * Handles the main content creation process.
         * @param {string} type The type of content to create ('game' or 'app').
         */
        const handleCreateContent = async (type) => {
            actionMenu.classList.add('hidden');
            submitPromptBtn.disabled = true;
            submitPromptBtn.textContent = 'Generating...';
            showStatusMessage(`Creating your ${type}...`, 'bg-blue-800 text-blue-200');
            
            // Clear any existing timer
            if (saveTimer) {
                clearTimeout(saveTimer);
            }

            const prompt = promptInput.value.trim();
            let fullPrompt = '';

            if (type === 'game') {
                fullPrompt = `You are a game development assistant. Your task is to generate the complete, self-contained HTML/CSS/JS code for a simple game based on the user's prompt. The game must be a single HTML file with all CSS in a <style> tag and all JavaScript in a <script> tag. The game must be fully contained within the <body> tag. Do not use any external files, libraries, or CDNs. Ensure the game is responsive and playable on a mobile phone. Do not include any placeholder text or external image links. Use only basic colors and shapes. The user's prompt is: ${prompt}.`;
            } else if (type === 'app') {
                fullPrompt = `You are an app development assistant. Your task is to generate the complete, self-contained HTML/CSS/JS code for a simple web-based app based on the user's prompt. The app must be a single HTML file with all CSS in a <style> tag and all JavaScript in a <script> tag. The app must be fully contained within the <body> tag. Do not use any external files, libraries, or CDNs. Ensure the app is responsive and works on a mobile phone. Do not include any placeholder text or external image links. Use only basic colors and shapes. The user's prompt is: ${prompt}.`;
            }

            try {
                const chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
                const payload = { contents: chatHistory };
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                
                let retries = 0;
                while (!response.ok && retries < 5) {
                    await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                    });
                    retries++;
                }

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // Check if the response structure is valid
                if (!result.candidates || result.candidates.length === 0 || !result.candidates[0].content || !result.candidates[0].content.parts || result.candidates[0].content.parts.length === 0) {
                    throw new Error("Invalid API response format.");
                }

                const generatedCode = result.candidates[0].content.parts[0].text;

                // Extract the code block from the response.
                const htmlMatch = generatedCode.match(/```html\n([\s\S]*?)```/);
                const contentCode = htmlMatch ? htmlMatch[1] : generatedCode;

                renderContent(contentCode);
                showStatusMessage(`${type} created successfully!`, 'bg-green-800 text-green-200');

                // If it's a game, set the 30-second auto-save timer
                if (type === 'game') {
                    saveTimer = setTimeout(saveGame, 30000);
                }

            } catch (e) {
                console.error("Failed to generate content:", e);
                // Provide a more specific error message based on the type of error
                if (e.message.includes("API call failed")) {
                    showStatusMessage("The server did not respond. Please check your internet connection.", 'bg-red-800 text-red-200');
                } else if (e.message.includes("Invalid API response")) {
                    showStatusMessage("Could not understand the response. The prompt may have violated a content policy. Please try a different prompt.", 'bg-red-800 text-red-200');
                } else {
                    showStatusMessage("Sorry, I couldn't create that. Please try a different prompt.", 'bg-red-800 text-red-200');
                }
            } finally {
                submitPromptBtn.disabled = false;
                submitPromptBtn.textContent = 'Submit Prompt';
            }
        };

        // Event listeners
        submitPromptBtn.addEventListener('click', () => {
            currentPrompt = promptInput.value.trim();
            if (currentPrompt === '') {
                showStatusMessage("Please enter a prompt first.", 'bg-red-800 text-red-200');
                return;
            }
            actionMenu.classList.remove('hidden');
        });
        createGameBtn.addEventListener('click', () => handleCreateContent('game'));
        createAppBtn.addEventListener('click', () => handleCreateContent('app'));
    </script>

</body>
</html>

