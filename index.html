<!DOCTYPE html>
, <html lang="en">
, <head>
, <meta charset="UTF-8" />
, <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
, <title>Pokémon Adventure</title>
, <meta name="theme-color" content="#e3350d"/>
, 
, <style>
,   :root{
,     --bg:#f5f6fa; --panel:#fff; --ink:#222; --ink-muted:#555;
,     --brand:#e3350d; --brand-2:#2a75bb; --ok:#2ecc71; --warn:#f39c12; --danger:#e74c3c;
,   }
,   *{box-sizing:border-box}
,   body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;background:var(--bg);color:var(--ink)}
,   header{position:sticky;top:0;background:var(--panel);padding:12px 16px;border-bottom:1px solid #ddd;z-index:2}
,   header h1{margin:0;font-size:18px}
,   .screen{display:none;padding:16px 16px 84px}
,   .screen.active{display:block}
,   .card{background:var(--panel);border:1px solid #e6e6e6;border-radius:12px;padding:12px;margin:8px 0;box-shadow:0 2px 6px rgba(0,0,0,.04)}
,   .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
,   .row > *{flex:1}
,   button{border:none;background:var(--brand);color:#fff;padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}
,   button.secondary{background:var(--brand-2)}
,   button.ghost{background:#eee;color:#000}
,   button.warn{background:var(--warn);color:#000}
,   button.ok{background:var(--ok)}
,   button.danger{background:var(--danger)}
,   input, select{width:100%;padding:10px;border:1px solid #d9d9d9;border-radius:10px}
,   .label{font-size:12px;color:var(--ink-muted);margin-top:6px}
,   .bar{height:8px;background:#eee;border-radius:6px;overflow:hidden}
,   .bar > span{display:block;height:100%;background:var(--brand-2);width:0%}
,   .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
,   .money{font-weight:700}
,   .tabs{position:fixed;bottom:0;left:0;right:0;background:var(--panel);border-top:1px solid #ddd;display:flex;z-index:3}
,   .tab{flex:1;text-align:center;padding:10px 6px;cursor:pointer;font-size:12px;color:var(--ink-muted)}
,   .tab.active{color:var(--brand);font-weight:700}
,   .sr{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
, </style>
, </head>
, <body>
, <header>
,   <h1>Pokémon Adventure</h1>
,   <div id="profileLine" class="label" aria-live="polite"></div>
, </header>
, 
, <!-- Screens -->
, <main>
,   <section id="home" class="screen active">
,     <div class="card">
,       <h2>Home</h2>
,       <div id="authArea" class="row" style="margin-top:8px">
,         <button id="btnOpenAuth" class="secondary">Sign Up / Log In</button>
,         <button id="btnGuest" class="ghost">Play as Guest</button>
,       </div>
,       <div class="label">Level: <span id="level">1</span> • XP: <span id="xp">0</span> • Money: ₽<span id="money">0</span></div>
,     </div>
, 
,     <div class="card">
,       <h3>Quick Actions</h3>
,       <div class="row">
,         <button id="btnGather" class="ok">Gather (+10 XP)</button>
,         <button id="btnHeal" class="secondary">Poké Center (Heal)</button>
,       </div>
,       <div id="gatherMsg" class="label" aria-live="polite"></div>
,     </div>
,   </section>
, 
,   <section id="explore" class="screen">
,     <div class="card">
,       <h2>Explore & Catch</h2>
,       <div class="row">
,         <button id="btnFindWild" class="secondary">Find Wild Pokémon</button>
,         <button id="btnThrowBall" class="ok">Throw Poké Ball</button>
,       </div>
,       <div id="wildArea" class="label" aria-live="polite">No encounter yet.</div>
,     </div>
,   </section>
, 
,   <section id="pokemon" class="screen">
,     <div class="card">
,       <h2>Pokémon</h2>
,       <div id="partyList" class="grid"></div>
,     </div>
,   </section>
, 
,   <section id="inventory" class="screen">
,     <div class="card">
,       <h2>Inventory</h2>
,       <div id="bagList"></div>
,     </div>
,   </section>
, 
,   <section id="market" class="screen">
,     <div class="card">
,       <h2>Poké Mart</h2>
,       <div class="row">
,         <select id="shopSelect">
,           <option value="Poké Ball">Poké Ball — ₽200</option>
,           <option value="Potion">Potion — ₽300</option>
,           <option value="Super Potion">Super Potion — ₽700</option>
,           <option value="Antidote">Antidote — ₽100</option>
,         </select>
,         <input id="shopQty" type="number" min="1" value="1"/>
,       </div>
,       <div class="row" style="margin-top:8px">
,         <button id="btnBuy" class="ok">Buy</button>
,         <button id="btnSell" class="warn">Sell</button>
,       </div>
,       <div class="label">Balance: ₽<span id="money2">0</span></div>
,       <div id="shopMsg" class="label" aria-live="polite"></div>
,     </div>
,   </section>
, 
,   <section id="battle" class="screen">
,     <div class="card">
,       <h2>Battle</h2>
,       <div class="row">
,         <select id="battlePick"></select>
,         <button id="btnStartBattle" class="secondary">Start Battle</button>
,       </div>
,       <div id="battleUI" style="display:none;margin-top:8px">
,         <div class="card">
,           <div><strong>Your</strong> <span id="bYourName"></span> — HP <span id="bYourHP"></span></div>
,           <div class="bar"><span id="bYourHPBar"></span></div>
,           <div class="label">Enemy <span id="bEnemyName"></span> — HP <span id="bEnemyHP"></span></div>
,           <div class="bar"><span id="bEnemyHPBar"></span></div>
,         </div>
,         <div id="moveButtons" class="grid"></div>
,         <div class="row">
,           <button id="btnRun" class="ghost">Run</button>
,         </div>
,         <div id="battleLog" class="label" aria-live="polite"></div>
,       </div>
,     </div>
,   </section>
, 
,   <section id="trade" class="screen">
,     <div class="card">
,       <h2>Trade</h2>
,       <div class="row">
,         <select id="tradePick"></select>
,         <button id="btnCreateTrade" class="secondary">Create Code</button>
,       </div>
,       <div class="label">Your code: <strong id="tradeCode">—</strong></div>
,       <div class="row" style="margin-top:8px">
,         <input id="tradeEnter" placeholder="Enter 6-digit code"/>
,         <button id="btnClaimTrade" class="ok">Claim Trade</button>
,       </div>
,       <div id="tradeMsg" class="label" aria-live="polite"></div>
,     </div>
,   </section>
, </main>
, 
, <!-- Bottom Tabs -->
, <nav class="tabs" role="tablist" aria-label="Main">
,   <div class="tab active" data-target="home" role="tab" aria-selected="true">Home</div>
,   <div class="tab" data-target="explore" role="tab" aria-selected="false">Explore</div>
,   <div class="tab" data-target="pokemon" role="tab" aria-selected="false">Pokémon</div>
,   <div class="tab" data-target="inventory" role="tab" aria-selected="false">Inventory</div>
,   <div class="tab" data-target="market" role="tab" aria-selected="false">Poké Mart</div>
,   <div class="tab" data-target="battle" role="tab" aria-selected="false">Battle</div>
,   <div class="tab" data-target="trade" role="tab" aria-selected="false">Trade</div>
, </nav>
, 
, <!-- Auth Modal (created here so it’s always the latest + unique IDs) -->
, <div id="authModal" class="sr" aria-live="polite"></div>
, 
, <script type="module">
, /* =========================
,    0) Helpers & PWA Bits
, ========================= */
, // Create a minimal manifest dynamically
, const manifest = {
,   name: "Pokémon Adventure",
,   short_name: "PokeAdv",
,   start_url: ".",
,   display: "standalone",
,   background_color: "#f5f6fa",
,   theme_color: "#e3350d",
,   icons: [
,     { src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='64' fill='%23e3350d'/%3E%3Ccircle cx='64' cy='64' r='40' fill='%23fff'/%3E%3Ccircle cx='64' cy='64' r='16' fill='%232a75bb'/%3E%3C/svg%3E", sizes: "128x128", type: "image/svg+xml" }
,   ]
, };
, const manifestBlob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
, const manifestURL = URL.createObjectURL(manifestBlob);
, const link = document.createElement('link');
, link.rel = 'manifest';
, link.href = manifestURL;
, document.head.appendChild(link);
, 
, // Simple service worker created at runtime (cache this page for offline)
, if ('serviceWorker' in navigator) {
,   const swCode = `
,     const CACHE='poke-adv-v1';
,     self.addEventListener('install', e=>{
,       e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));
,       self.skipWaiting();
,     });
,     self.addEventListener('activate', e=>{
,       e.waitUntil(self.clients.claim());
,     });
,     self.addEventListener('fetch', e=>{
,       e.respondWith(
,         caches.match(e.request).then(r=> r || fetch(e.request).catch(()=>caches.match('./')))
,       );
,     });
,   `;
,   const swBlob = new Blob([swCode], {type:'text/javascript'});
,   navigator.serviceWorker.register(URL.createObjectURL(swBlob));
, }
, 
, /* =========================
,    1) Lightweight Audio (inline)
,    (No files; uses WebAudio)
, ========================= */
, const audioCtx = (typeof AudioContext !== 'undefined') ? new AudioContext() : null;
, async function playCoin(){ if(!audioCtx) return; const ctx=audioCtx; const o=ctx.createOscillator(); const g=ctx.createGain(); o.connect(g); g.connect(ctx.destination); o.type='triangle'; o.frequency.setValueAtTime(880,ctx.currentTime); g.gain.setValueAtTime(0.001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.3,ctx.currentTime+0.01); o.start(); o.frequency.exponentialRampToValueAtTime(1760, ctx.currentTime+0.12); g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.13); o.stop(ctx.currentTime+0.14);}
, async function playRegister(){ if(!audioCtx) return; const ctx=audioCtx; const o=ctx.createOscillator(); const g=ctx.createGain(); o.connect(g); g.connect(ctx.destination); o.type='square'; o.frequency.setValueAtTime(523,ctx.currentTime); g.gain.setValueAtTime(0.001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.25,ctx.currentTime+0.01); o.start(); o.frequency.setValueAtTime(784, ctx.currentTime+0.08); g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.18); o.stop(ctx.currentTime+0.2);}
, 
, /* =========================
,    2) Tiny Data Model
, ========================= */
, const $ = sel => document.querySelector(sel);
, const $$ = sel => [...document.querySelectorAll(sel)];
, const state = {
,   user:{ uid:'guest', name:'Guest', email:null, money: 1000, xp:0, party:[], bag:{'Poké Ball':5, 'Potion':2}, healedAt:0 },
,   wild:null,
,   firebaseOK:false
, };
, function levelFromXP(x){ return Math.floor(x/100)+1; }
, function save(){ localStorage.setItem('poke-adv-state', JSON.stringify(state)); }
, function load(){
,   const raw = localStorage.getItem('poke-adv-state');
,   if(raw){
,     try{ const s=JSON.parse(raw); Object.assign(state, s); }catch{}
,   }
, }
, load();
, 
, /* =========================
,    3) Bottom Tabs
, ========================= */
, $$('.tab').forEach(tab=>{
,   tab.addEventListener('click', ()=>{
,     $$('.tab').forEach(t=>{t.classList.remove('active'); t.setAttribute('aria-selected','false');});
,     tab.classList.add('active'); tab.setAttribute('aria-selected','true');
,     const id = tab.dataset.target;
,     $$('.screen').forEach(sc=>sc.classList.remove('active'));
,     $('#'+id).classList.add('active');
,   });
, });
, 
, /* =========================
,    4) Minimal Pokédex (first 54)
,    (Stats simplified; 4 moves)
, ========================= */
, const POKEDEX = [
,   {id:1,name:"Bulbasaur",type:"Grass/Poison",hp:45,atk:49,def:49,spd:45,moves:["Tackle","Vine Whip","Growl","Leech Seed"]},
,   {id:2,name:"Ivysaur",type:"Grass/Poison",hp:60,atk:62,def:63,spd:60,moves:["Tackle","Razor Leaf","Growl","Vine Whip"]},
,   {id:3,name:"Venusaur",type:"Grass/Poison",hp:80,atk:82,def:83,spd:80,moves:["Vine Whip","Razor Leaf","Growl","Tackle"]},
,   {id:4,name:"Charmander",type:"Fire",hp:39,atk:52,def:43,spd:65,moves:["Scratch","Ember","Growl","Smokescreen"]},
,   {id:5,name:"Charmeleon",type:"Fire",hp:58,atk:64,def:58,spd:80,moves:["Scratch","Ember","Smokescreen","Leer"]},
,   {id:6,name:"Charizard",type:"Fire/Flying",hp:78,atk:84,def:78,spd:100,moves:["Ember","Slash","Smokescreen","Wing Attack"]},
,   {id:7,name:"Squirtle",type:"Water",hp:44,atk:48,def:65,spd:43,moves:["Tackle","Water Gun","Tail Whip","Withdraw"]},
,   {id:8,name:"Wartortle",type:"Water",hp:59,atk:63,def:80,spd:58,moves:["Tackle","Water Gun","Tail Whip","Bite"]},
,   {id:9,name:"Blastoise",type:"Water",hp:79,atk:83,def:100,spd:78,moves:["Water Gun","Bite","Tackle","Withdraw"]},
,   {id:10,name:"Caterpie",type:"Bug",hp:45,atk:30,def:35,spd:45,moves:["Tackle","String Shot","Harden","Bug Bite"]},
,   {id:11,name:"Metapod",type:"Bug",hp:50,atk:20,def:55,spd:30,moves:["Harden","Tackle","String Shot","Bug Bite"]},
,   {id:12,name:"Butterfree",type:"Bug/Flying",hp:60,atk:45,def:50,spd:70,moves:["Gust","Confusion","Stun Spore","Tackle"]},
,   {id:13,name:"Weedle",type:"Bug/Poison",hp:40,atk:35,def:30,spd:50,moves:["Poison Sting","String Shot","Bug Bite","Tackle"]},
,   {id:14,name:"Kakuna",type:"Bug/Poison",hp:45,atk:25,def:50,spd:35,moves:["Harden","Poison Sting","Bug Bite","Tackle"]},
,   {id:15,name:"Beedrill",type:"Bug/Poison",hp:65,atk:90,def:40,spd:75,moves:["Fury Attack","Poison Sting","Twinneedle","Rage"]},
,   {id:16,name:"Pidgey",type:"Normal/Flying",hp:40,atk:45,def:40,spd:56,moves:["Tackle","Gust","Sand Attack","Quick Attack"]},
,   {id:17,name:"Pidgeotto",type:"Normal/Flying",hp:63,atk:60,def:55,spd:71,moves:["Gust","Quick Attack","Tackle","Sand Attack"]},
,   {id:18,name:"Pidgeot",type:"Normal/Flying",hp:83,atk:80,def:75,spd:101,moves:["Gust","Quick Attack","Wing Attack","Sand Attack"]},
,   {id:19,name:"Rattata",type:"Normal",hp:30,atk:56,def:35,spd:72,moves:["Tackle","Quick Attack","Tail Whip","Bite"]},
,   {id:20,name:"Raticate",type:"Normal",hp:55,atk:81,def:60,spd:97,moves:["Quick Attack","Bite","Tackle","Hyper Fang"]},
,   {id:21,name:"Spearow",type:"Normal/Flying",hp:40,atk:60,def:30,spd:70,moves:["Peck","Growl","Quick Attack","Leer"]},
,   {id:22,name:"Fearow",type:"Normal/Flying",hp:65,atk:90,def:65,spd:100,moves:["Peck","Drill Peck","Quick Attack","Leer"]},
,   {id:23,name:"Ekans",type:"Poison",hp:35,atk:60,def:44,spd:55,moves:["Wrap","Poison Sting","Bite","Leer"]},
,   {id:24,name:"Arbok",type:"Poison",hp:60,atk:95,def:69,spd:80,moves:["Wrap","Poison Sting","Bite","Glare"]},
,   {id:25,name:"Pikachu",type:"Electric",hp:35,atk:55,def:30,spd:90,moves:["Thunder Shock","Quick Attack","Tail Whip","Growl"]},
,   {id:26,name:"Raichu",type:"Electric",hp:60,atk:90,def:55,spd:110,moves:["Thunder Shock","Quick Attack","Slam","Tail Whip"]},
,   {id:27,name:"Sandshrew",type:"Ground",hp:50,atk:75,def:85,spd:40,moves:["Scratch","Sand Attack","Slash","Defense Curl"]},
,   {id:28,name:"Sandslash",type:"Ground",hp:75,atk:100,def:110,spd:65,moves:["Scratch","Slash","Sand Attack","Fury Swipes"]},
,   {id:29,name:"Nidoran♀",type:"Poison",hp:55,atk:47,def:52,spd:41,moves:["Scratch","Poison Sting","Growl","Bite"]},
,   {id:30,name:"Nidorina",type:"Poison",hp:70,atk:62,def:67,spd:56,moves:["Scratch","Poison Sting","Bite","Tail Whip"]},
,   {id:31,name:"Nidoqueen",type:"Poison/Ground",hp:90,atk:92,def:87,spd:76,moves:["Scratch","Poison Sting","Body Slam","Bite"]},
,   {id:32,name:"Nidoran♂",type:"Poison",hp:46,atk:57,def:40,spd:50,moves:["Peck","Poison Sting","Focus Energy","Horn Attack"]},
,   {id:33,name:"Nidorino",type:"Poison",hp:61,atk:72,def:57,spd:65,moves:["Horn Attack","Poison Sting","Fury Attack","Leer"]},
,   {id:34,name:"Nidoking",type:"Poison/Ground",hp:81,atk:102,def:77,spd:85,moves:["Horn Attack","Poison Sting","Thrash","Double Kick"]},
,   {id:35,name:"Clefairy",type:"Fairy",hp:70,atk:45,def:48,spd:35,moves:["Pound","Sing","Growl","Double Slap"]},
,   {id:36,name:"Clefable",type:"Fairy",hp:95,atk:70,def:73,spd:60,moves:["Pound","Sing","Double Slap","Minimize"]},
,   {id:37,name:"Vulpix",type:"Fire",hp:38,atk:41,def:40,spd:65,moves:["Ember","Quick Attack","Tail Whip","Roar"]},
,   {id:38,name:"Ninetales",type:"Fire",hp:73,atk:76,def:75,spd:100,moves:["Em, In list