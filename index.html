<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accessible Madden Prototype</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }
  .menu, .submenu, .playbook {
    margin: 10px 0;
  }
  button, select {
    font-size: 1.2em;
    margin: 5px;
    padding: 10px 20px;
  }
  .playbook {
    display: none;
    flex-direction: column;
    align-items: center;
  }
</style>
</head>
<body>

<h1>Accessible Madden Prototype</h1>

<!-- Main Menu -->
<div id="mainMenu" class="menu">
  <button onclick="openQuickPlay()">Quick Play</button>
  <button onclick="openFranchise()">Franchise</button>
  <button onclick="openPractice()">Practice</button>
  <button onclick="openUltimateTeam()">Ultimate Team</button>
  <button onclick="openSettings()">Settings</button>
</div>

<!-- Quick Play Menu -->
<div id="quickPlayMenu" class="submenu" style="display:none;">
  <button onclick="startPlay('Play Now')">Play Now</button>
  <button onclick="startPlay('Pro Bowl')">Pro Bowl</button>
  <button onclick="startPlay('Super Bowl 59: Chiefs vs Eagles')">Super Bowl 59</button>
  <button onclick="backToMain()">Back</button>
</div>

<!-- Settings Menu -->
<div id="settingsMenu" class="submenu" style="display:none;">
  <label for="difficulty">Difficulty:</label>
  <select id="difficulty">
    <option>Rookie</option>
    <option>Pro</option>
    <option>All-Pro</option>
    <option>All-Madden</option>
  </select><br>
  
  <label for="quarterLength">Quarter Length (min):</label>
  <select id="quarterLength">
    <option>2</option>
    <option selected>5</option>
    <option>10</option>
    <option>15</option>
  </select><br>

  <label for="gameSpeed">Game Speed:</label>
  <select id="gameSpeed">
    <option>Slow</option>
    <option selected>Normal</option>
    <option>Fast</option>
  </select><br>

  <div id="volumeDisplay">Crowd Volume: 50%</div>

  <button onclick="backToMain()">Back</button>
</div>

<!-- Playbook -->
<div id="playbookMenu" class="playbook">
  <h2>Playbook</h2>
  <div id="playName">Select a play</div>
  <button onclick="choosePlay()">Select Play</button>
  <button onclick="endDrive()">End Drive</button>
</div>

<!-- Commentary Area -->
<div id="commentary" style="margin-top:20px; max-width: 500px;">
</div>

<script>
const commentaryDiv = document.getElementById('commentary');

// Crowd Audio
const crowdAudio = new Audio('https://www.soundjay.com/crowd/crowd-cheer-01.mp3');
let crowdVolume = 0.5;
crowdAudio.volume = crowdVolume;

// TTS function
function speak(text) {
  if ('speechSynthesis' in window) {
    const msg = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
  }
}

// Swipe gestures for crowd volume
let touchStartY = null;
document.addEventListener('touchstart', e => { touchStartY = e.touches[0].clientY; });
document.addEventListener('touchend', e => {
  if (touchStartY === null) return;
  const touchEndY = e.changedTouches[0].clientY;
  const delta = touchStartY - touchEndY;
  if (delta > 30) { crowdVolume = Math.min(crowdVolume + 0.1, 1); }
  else if (delta < -30) { crowdVolume = Math.max(crowdVolume - 0.1, 0); }
  crowdAudio.volume = crowdVolume;
  document.getElementById('volumeDisplay').innerText = `Crowd Volume: ${Math.round(crowdVolume*100)}%`;
  speak(`Crowd volume ${Math.round(crowdVolume*100)} percent`);
  touchStartY = null;
});

// Main Menu Functions
function openQuickPlay() {
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('quickPlayMenu').style.display = 'block';
  speak("Quick Play menu. Choose Play Now, Pro Bowl, or Super Bowl 59: Chiefs vs Eagles.");
}

function openFranchise() {
  document.getElementById('mainMenu').style.display = 'none';
  speak("Franchise mode. Start new franchise or continue if you have one.");
}

function openPractice() {
  document.getElementById('mainMenu').style.display = 'none';
  speak("Practice mode. Choose drills or free play.");
}

function openUltimateTeam() {
  document.getElementById('mainMenu').style.display = 'none';
  speak("Ultimate Team mode. Coming soon.");
}

function openSettings() {
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('settingsMenu').style.display = 'block';
  speak("Settings menu. Choose difficulty, quarter length, game speed, and adjust crowd volume.");
}

function backToMain() {
  document.getElementById('mainMenu').style.display = 'block';
  document.getElementById('quickPlayMenu').style.display = 'none';
  document.getElementById('settingsMenu').style.display = 'none';
  document.getElementById('playbookMenu').style.display = 'none';
  speak("Main menu. Quick Play, Franchise, Practice, Ultimate Team, Settings.");
}

// Quick Play Start
function startPlay(type) {
  speak(`Starting ${type}. First and 10 at the 25-yard line. Choose your play.`);
  commentaryDiv.innerHTML = `Game started: ${type}. First and 10 at the 25-yard line.`;

  // Show playbook
  document.getElementById('playbookMenu').style.display = 'flex';
  currentPlayIndex = 0;
  showCurrentPlay();
}

// Playbook
const plays = ["Inside Zone Run", "Outside Zone Run", "QB Sneak", "Short Pass", "Deep Pass", "Screen Pass"];
let currentPlayIndex = 0;

function showCurrentPlay() {
  document.getElementById('playName').innerText = plays[currentPlayIndex];
  speak(plays[currentPlayIndex]);
}

// Swipe left/right to navigate plays
let touchStartX = null;
document.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; });
document.addEventListener('touchend', e => {
  if (touchStartX === null) return;
  const touchEndX = e.changedTouches[0].clientX;
  const delta = touchStartX - touchEndX;
  if (delta > 30) { currentPlayIndex = (currentPlayIndex + 1) % plays.length; }
  else if (delta < -30) { currentPlayIndex = (currentPlayIndex - 1 + plays.length) % plays.length; }
  showCurrentPlay();
  touchStartX = null;
});

// Choose play
function choosePlay() {
  const selectedPlay = plays[currentPlayIndex];
  commentaryDiv.innerHTML += `<br>Selected: ${selectedPlay}`;

  // Create a "Tap to Execute Play" button for mobile-proof crowd sound
  let executeBtn = document.getElementById('executePlayBtn');
  if(!executeBtn){
    executeBtn = document.createElement('button');
    executeBtn.id = 'executePlayBtn';
    executeBtn.innerText = 'Tap to Execute Play';
    executeBtn.onclick = () => executePlay(selectedPlay);
    document.getElementById('playbookMenu').appendChild(executeBtn);
  }
}

// Execute play
function executePlay(play) {
  // Play crowd audio immediately on user tap
  crowdAudio.currentTime = 0;
  crowdAudio.play().catch(()=>{ console.log("Audio blocked"); });

  // Then simulate play outcome
  simulatePlay(play);

  // Remove button
  const btn = document.getElementById('executePlayBtn');
  if(btn) btn.remove();
}

// Simulate play outcome
function simulatePlay(play) {
  let outcome = "";
  if(play.includes("Run")) outcome = Math.random() > 0.5 ? "Gain 5 yards!" : "Loss 2 yards!";
  else if(play.includes("Pass")) outcome = Math.random() > 0.5 ? "Complete! Gain 10 yards!" : "Incomplete pass!";
  speak(outcome);
  commentaryDiv.innerHTML += `<br>${play}: ${outcome}`;
}

// End drive
function endDrive() {
  speak("Drive ended. Returning to Quick Play menu.");
  document.getElementById('playbookMenu').style.display = 'none';
}
</script>

</body>
</html>