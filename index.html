Here is the updated code with all the features: